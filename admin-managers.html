<!DOCTYPE html>
<html lang="en">
<head>
    <!-- PWA support -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#3498db">
    <link rel="icon" href="assets/images/logo11.webp" type="image/webp">
    <link rel="shortcut icon" href="assets/images/logo11.webp" type="image/webp">
    <link rel="apple-touch-icon" href="/assets/images/logo11.webp">

    <!-- DNS prefetch and preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <title>R2G Admin - Managers</title>
    
    <!-- Inline critical CSS -->
    <style>
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: #121212;
            color: #e0e0e0;
            margin: 0;
            padding: 0;
        }
        
        .header {
            background-color: #181820;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.4);
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid #252530;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .header h1 {
            margin: 0;
            font-size: 22px;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .header h1 i {
            color: #3498db;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .username-container {
            background-color: rgba(0, 0, 0, 0.2);
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .username {
            color: #bada55;
            font-weight: 600;
        }
        
        .btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 14px;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            font-size: 14px;
            transition: all 0.2s ease;
            font-weight: 500;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);
        }
        
        .btn i {
            font-size: 14px;
        }
        
        .btn:hover {
            background-color: #2980b9;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 3px rgba(0, 0, 0, 0.2);
        }
        
        .btn-red {
            background-color: #e74c3c;
        }
        
        .btn-red:hover {
            background-color: #c0392b;
        }
        
        .btn-green {
            background-color: #2ecc71;
        }
        
        .btn-green:hover {
            background-color: #27ae60;
        }
        
        .btn-purple {
            background-color: #9b59b6;
        }
        
        .btn-purple:hover {
            background-color: #8e44ad;
        }
        
        .btn-orange {
            background-color: #e67e22;
        }
        
        .btn-orange:hover {
            background-color: #d35400;
        }
        
        .container {
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .action-bar {
            background-color: #181820;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            padding: 15px;
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            align-items: center;
        }
        
        .manager-grid {
            display: grid;
            grid-template-columns: 340px 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .sidebar {
            background-color: #181820;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            max-height: calc(100vh - 140px);
            overflow-y: auto;
            position: sticky;
            top: 90px;
            scrollbar-width: thin;
            scrollbar-color: #3498db #1e1e24;
        }
        
        .sidebar::-webkit-scrollbar {
            width: 8px;
        }
        
        .sidebar::-webkit-scrollbar-track {
            background: #1e1e24;
            border-radius: 4px;
        }
        
        .sidebar::-webkit-scrollbar-thumb {
            background-color: #3498db;
            border-radius: 4px;
        }
        
        .content {
            background-color: #181820;
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            max-height: calc(100vh - 140px);
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: #3498db #1e1e24;
        }
        
        .content::-webkit-scrollbar {
            width: 8px;
        }
        
        .content::-webkit-scrollbar-track {
            background: #1e1e24;
            border-radius: 4px;
        }
        
        .content::-webkit-scrollbar-thumb {
            background-color: #3498db;
            border-radius: 4px;
        }
        
        .search-box {
            width: 100%;
            padding: 12px 16px;
            margin-bottom: 15px;
            border-radius: 6px;
            border: 1px solid #2a2a35;
            background-color: #1e1e24;
            color: #e0e0e0;
            box-sizing: border-box;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .search-box:focus {
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.3);
            outline: none;
            background-color: #252530;
        }
        
        .manager-list {
            list-style: none;
            padding: 0;
            margin: 0;
            border-radius: 6px;
            overflow: hidden;
            background-color: #1e1e24;
        }
        
        .manager-item {
            padding: 12px 15px;
            margin-bottom: 2px;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            transition: all 0.2s;
            background-color: #1e1e24;
            border-left: 3px solid transparent;
            gap: 15px;
        }
        
        .manager-item:hover {
            background-color: #252530;
            border-left-color: #3498db;
        }
        
        .manager-item.selected {
            background-color: #1e2a38;
            border-left-color: #2ecc71;
        }
        
        .manager-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #252530;
            color: #fff;
            font-size: 18px;
            font-weight: 600;
            flex-shrink: 0;
            overflow: hidden;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            border: 2px solid #353540;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        
        .selected .manager-icon {
            background-color: #1e2a38;
            border: 2px solid #2ecc71;
            box-shadow: 0 0 8px rgba(46, 204, 113, 0.4);
        }
        
        .manager-details {
            flex-grow: 1;
            min-width: 0;
        }
        
        .manager-name {
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-bottom: 6px;
            color: #fff;
            font-size: 15px;
        }
        
        .manager-club {
            color: #bada55;
            font-size: 12px;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            display: flex;
            align-items: center;
            gap: 6px;
            background-color: rgba(30, 30, 40, 0.6);
            padding: 3px 8px;
            border-radius: 12px;
            width: fit-content;
        }
        
        .manager-club i {
            font-size: 11px;
        }
        
        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
        }
        
        .mobile-logout {
            display: none;
        }
        
        @media (max-width: 768px) {
            .header {
                padding: 12px 15px;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            
            .header-left {
                gap: 10px;
                flex: 1;
            }
            
            .header h1 {
                font-size: 16px;
            }
            
            .user-info {
                display: none;
            }
            
            .mobile-logout {
                display: flex;
                align-items: center;
                font-size: 13px;
                padding: 8px 10px;
            }
            
            .manager-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .mobile-menu-toggle {
                display: block;
                order: 1;
                margin-right: 10px;
                transition: transform 0.3s ease;
            }
            
            .mobile-menu-toggle:hover {
                transform: scale(1.1);
            }
            
            .user-info {
                display: none;
                width: 100%;
                flex-direction: column;
                align-items: flex-start;
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                background-color: #1e1e2d;
                padding: 15px;
                box-shadow: 0 5px 10px rgba(0, 0, 0, 0.3);
                gap: 10px;
                border-top: 1px solid #2d2d3a;
                z-index: 150;
                transition: transform 0.3s ease, opacity 0.3s ease;
                transform: translateY(-10px);
                opacity: 0;
            }
            
            .user-info.show {
                display: flex;
                transform: translateY(0);
                opacity: 1;
            }
            
            .user-info a, 
            .user-info button {
                width: 100%;
                justify-content: center;
            }
            
            .username-container {
                width: 100%;
                box-sizing: border-box;
                margin-bottom: 5px;
                text-align: center;
            }
            
            .sidebar {
                max-height: none;
                position: static;
                margin-bottom: 15px;
                display: block;
                overflow-y: auto;
                border-radius: 8px;
                background-color: #1e1e24;
                padding: 20px;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            }
            
            .content {
                max-height: none;
                padding: 20px;
                background-color: #1e1e24;
                border-radius: 8px;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            }
            
            .manager-item {
                padding: 12px 15px;
                margin-bottom: 8px;
                border-radius: 6px;
                cursor: pointer;
                display: flex;
                align-items: center;
                transition: all 0.2s ease;
                background-color: #252530;
                border: 1px solid transparent;
            }
            
            .manager-item:hover {
                background-color: #2a2a35;
                transform: translateY(-1px);
                box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
            }
            
            .manager-item.selected {
                background-color: rgba(52, 152, 219, 0.15);
                border: 1px solid rgba(52, 152, 219, 0.5);
            }
            
            .search-box {
                width: 100%;
                padding: 12px 15px;
                margin-bottom: 20px;
                border-radius: 6px;
                border: 1px solid #333340;
                background-color: #252530;
                color: #fff;
                box-sizing: border-box;
                font-size: 15px;
                transition: all 0.2s ease;
            }
            
            .search-box:focus {
                border-color: #3498db;
                box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
                outline: none;
            }
        }
        
        .search-container {
            position: relative;
            margin-bottom: 20px;
        }
        
        .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
            pointer-events: none;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #bbb;
            font-size: 14px;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px 16px;
            border-radius: 6px;
            border: 1px solid #2a2a35;
            background-color: #1e1e24;
            color: #e0e0e0;
            box-sizing: border-box;
            font-family: inherit;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.3);
            outline: none;
            background-color: #252530;
        }
        
        input:disabled, select:disabled, textarea:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }
        
        input[readonly] {
            background-color: #1e2a38;
            border-color: #2a3642;
            font-weight: 500;
        }
        
        select {
            appearance: none;
            background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23FFFFFF%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E");
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 12px;
            padding-right: 30px;
        }
        
        .actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            justify-content: flex-end;
        }
        
        .actions button {
            padding: 12px 20px;
            font-weight: 500;
            min-width: 100px;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 25px;
            overflow-x: auto;
            scrollbar-width: thin;
            scrollbar-color: #555 #333;
            background-color: #1e1e24;
            border-radius: 6px;
            padding: 5px;
        }
        
        .tab-btn {
            padding: 12px 20px;
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            font-size: 15px;
            font-weight: 500;
            transition: all 0.2s;
            white-space: nowrap;
            border-radius: 4px;
        }
        
        .tab-btn:hover {
            color: #ddd;
            background-color: rgba(52, 152, 219, 0.15);
        }
        
        .tab-btn.active {
            color: #fff;
            background-color: #3498db;
        }
        
        .tab-content {
            margin-top: 20px;
        }
        
        .tab-pane {
            display: none;
        }
        
        .tab-pane.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .tab-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #444;
        }
        
        .tab-header h3 {
            margin: 0;
            font-size: 18px;
            color: #2ecc71;
        }
        
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .tab-btn {
                padding: 10px 15px;
                font-size: 14px;
            }
            
            .actions {
                flex-wrap: wrap;
            }
            
            .actions button {
                flex: 1;
                min-width: 0;
                padding: 10px;
                font-size: 13px;
            }
        }
        
        .squad-item {
            background-color: #1e1e24;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 15px;
            display: grid;
            grid-template-columns: 2fr 1fr auto;
            gap: 15px;
            position: relative;
            transition: all 0.2s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            border-left: 3px solid transparent;
        }
        
        .squad-item:hover {
            background-color: #252530;
            border-left-color: #3498db;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            transform: translateY(-2px);
        }
        
        .squad-info {
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .squad-player-name {
            font-weight: 600;
            margin-bottom: 8px;
            color: #fff;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .squad-details {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .squad-player-position, 
        .squad-player-value, 
        .squad-player-contract,
        .squad-player-type {
            font-size: 13px;
            color: #bbb;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .squad-player-position {
            padding: 3px 10px;
            background-color: #1e3a8a;
            border-radius: 12px;
            color: white;
            font-weight: 500;
            font-size: 12px;
        }
        
        .squad-player-value {
            color: #2ecc71;
            font-weight: 500;
        }
        
        .squad-player-type {
            text-transform: capitalize;
            background-color: rgba(52, 152, 219, 0.2);
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .squad-player-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .squad-player-actions button {
            background-color: #252530;
            border: none;
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
        }
        
        .squad-player-actions .edit-btn:hover {
            background-color: #3498db;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .squad-player-actions .delete-btn:hover {
            background-color: #e74c3c;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .season-item {
            background-color: #1e1e24;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            position: relative;
            transition: all 0.2s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            border-left: 3px solid transparent;
        }
        
        .season-item:hover {
            background-color: #252530;
            border-left-color: #e67e22;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            transform: translateY(-2px);
        }
        
        .season-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 18px;
            padding-bottom: 10px;
            border-bottom: 1px solid #2a2a35;
        }
        
        .season-number {
            font-size: 18px;
            font-weight: 600;
            color: #e67e22;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .season-number i {
            font-size: 16px;
        }
        
        .season-actions {
            display: flex;
            gap: 8px;
        }
        
        .season-actions button {
            background-color: #252530;
            border: none;
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
        }
        
        .season-actions .edit-btn:hover {
            background-color: #3498db;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .season-actions .delete-btn:hover {
            background-color: #e74c3c;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .season-sections {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }
        
        .season-section {
            background-color: #252530;
            border-radius: 8px;
            padding: 16px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
        }
        
        .season-section-title {
            font-size: 15px;
            font-weight: 600;
            color: #3498db;
            margin-bottom: 15px;
            border-bottom: 1px dashed #2a2a35;
            padding-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .season-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            font-size: 14px;
        }
        
        .season-detail {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px dashed rgba(255, 255, 255, 0.05);
        }
        
        .season-label {
            color: #aaa;
            font-weight: 500;
        }
        
        .season-value {
            font-weight: 600;
            color: #e3e3e3;
        }
        
        .season-stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .season-stat-item {
            background-color: rgba(20, 20, 30, 0.7);
            padding: 12px;
            border-radius: 6px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
            transition: all 0.2s;
        }
        
        .season-stat-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            background-color: rgba(30, 30, 40, 0.9);
        }
        
        .season-stat-value {
            font-size: 22px;
            font-weight: 700;
            color: #fff;
        }
        
        .season-stat-label {
            font-size: 12px;
            color: #bbb;
            margin-top: 6px;
            font-weight: 500;
        }
        
        .season-competitions {
            margin-top: 15px;
        }
        
        .season-competition-title {
            font-size: 15px;
            font-weight: 600;
            color: #3498db;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .season-competition-title i {
            color: #e67e22;
        }
        
        .season-competition-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 12px;
            background-color: rgba(20, 20, 30, 0.7);
            border-radius: 6px;
            margin-bottom: 8px;
            transition: all 0.2s;
        }
        
        .season-competition-item:hover {
            background-color: rgba(30, 30, 40, 0.9);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .competition-name {
            font-weight: 500;
            color: #e3e3e3;
        }
        
        .competition-position {
            color: #e67e22;
            font-weight: 600;
            background-color: rgba(230, 126, 34, 0.15);
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 13px;
        }
        
        .season-rank {
            color: #fff;
            font-weight: 600;
            display: inline-block;
            padding: 5px 12px;
            background-color: rgba(52, 152, 219, 0.2);
            border-radius: 6px;
            margin-bottom: 12px;
            font-size: 14px;
        }
        
        .season-points {
            color: #e74c3c;
            font-weight: 600;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .season-finance {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 15px;
        }
        
        .season-finance span {
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 6px;
            background-color: rgba(20, 20, 30, 0.7);
            padding: 6px 12px;
            border-radius: 6px;
            font-weight: 500;
        }
        
        .season-finance .income {
            color: #2ecc71;
        }
        
        .season-finance .expense {
            color: #e74c3c;
        }
        
        .season-finance .profit {
            color: #f1c40f;
        }
        
        .season-rewards {
            font-size: 14px;
            color: #f1c40f;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            background-color: rgba(241, 196, 15, 0.15);
            padding: 6px 12px;
            border-radius: 6px;
            margin-top: 10px;
            display: inline-block;
        }
        
        @media (max-width: 768px) {
            .season-sections {
                grid-template-columns: 1fr;
            }
            
            .season-stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        .empty-message {
            background-color: rgba(30, 30, 40, 0.3);
            padding: 25px;
            border-radius: 8px;
            text-align: center;
            color: #bbb;
            font-style: italic;
            margin: 15px 0;
            border: 1px dashed rgba(52, 152, 219, 0.3);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .empty-message i {
            font-size: 36px;
            color: #3498db;
            margin-bottom: 15px;
            opacity: 0.6;
        }
        
        .empty-message p {
            margin: 0;
            font-size: 15px;
        }
        
        .empty-message .btn {
            margin-top: 15px;
        }
        
        @media (max-width: 768px) {
            .squad-item {
                grid-template-columns: 1fr;
            }
            
            .squad-details {
                margin-bottom: 10px;
            }
            
            .squad-player-actions {
                justify-content: flex-end;
            }
            
            .season-details {
                grid-template-columns: 1fr;
            }
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.75);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            backdrop-filter: blur(4px);
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal {
            background-color: #181820;
            border-radius: 12px;
            padding: 30px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.5);
            transform: translateY(-20px) scale(0.95);
            transition: all 0.3s ease;
            max-height: 85vh;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: #3498db #1e1e24;
            border: 1px solid #252530;
        }
        
        .modal::-webkit-scrollbar-track {
            background: #1e1e24;
            border-radius: 4px;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #252530;
        }
        
        .modal-header h3 {
            margin: 0;
            color: #fff;
            font-size: 22px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .modal-header h3 i {
            color: #3498db;
        }
        
        .close-modal {
            background: none;
            border: none;
            color: #999;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            transition: all 0.2s;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            background-color: #1e1e24;
        }
        
        .close-modal:hover {
            color: #fff;
            background-color: #e74c3c;
        }
        
        .modal-section-title {
            color: #3498db;
            font-size: 16px;
            font-weight: 600;
            margin: 25px 0 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #353547;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .modal-section-title i {
            font-size: 14px;
        }
        
        .competition-entry {
            background-color: #1e1e24;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            position: relative;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            border: 1px solid #252530;
        }
        
        .competition-entry .remove-competition {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #252530;
            border: 1px solid #2a2a35;
            color: #e74c3c;
            width: 30px;
            height: 30px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .competition-entry .remove-competition:hover {
            background-color: #e74c3c;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        @media (max-width: 768px) {
            .modal {
                padding: 20px;
                max-width: 95%;
            }
            
            .modal-header h3 {
                font-size: 20px;
            }
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 25px;
            gap: 8px;
        }
        
        .pagination button {
            background-color: #1e1e24;
            border: none;
            color: #e0e0e0;
            min-width: 36px;
            height: 36px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
        }
        
        .pagination button:hover:not(:disabled) {
            background-color: #3498db;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .pagination button.active {
            background-color: #2ecc71;
            color: white;
        }
        
        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .pagination button i {
            font-size: 14px;
        }
        
        @media (max-width: 768px) {
            .pagination {
                margin-top: 20px;
                gap: 6px;
            }
            
            .pagination button {
                min-width: 32px;
                height: 32px;
                font-size: 13px;
            }
        }
        
        .toast {
            position: fixed;
            bottom: 25px;
            right: 25px;
            background-color: #1e1e24;
            color: #e0e0e0;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
            font-weight: 500;
            max-width: 350px;
            display: flex;
            align-items: center;
            gap: 12px;
            border-left: 4px solid;
        }
        
        .toast.success {
            background-color: #1e1e24;
            border-color: #2ecc71;
        }
        
        .toast.error {
            background-color: #1e1e24;
            border-color: #e74c3c;
        }
        
        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .toast::before {
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            font-size: 18px;
        }
        
        .toast.success::before {
            content: '\f00c';
            color: #2ecc71;
        }
        
        .toast.error::before {
            content: '\f00d';
            color: #e74c3c;
        }
        
        @media (max-width: 768px) {
            .toast {
                bottom: 15px;
                right: 15px;
                left: 15px;
                max-width: none;
                width: auto;
                padding: 12px 15px;
            }
        }
        
        .preloader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #121212;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }
        
        .loader {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(52, 152, 219, 0.2);
            border-radius: 50%;
            border-top-color: #3498db;
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 15px;
        }
        
        .preloader-text {
            color: #3498db;
            font-size: 16px;
            font-weight: 500;
            letter-spacing: 1px;
            animation: pulse 1.5s infinite ease-in-out;
        }
        
        @keyframes pulse {
            0% { opacity: 0.5; }
            50% { opacity: 1; }
            100% { opacity: 0.5; }
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .manager-grid {
                grid-template-columns: 1fr;
            }
            
            .form-grid,
            .performance-stats,
            .season-details {
                grid-template-columns: 1fr;
            }
        }
        
        #no-manager-selected {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 20px;
            background-color: rgba(30, 30, 40, 0.2);
            border-radius: 8px;
            text-align: center;
            min-height: 400px;
            border: 1px dashed #252530;
        }
        
        #no-manager-selected i {
            font-size: 64px;
            color: #3498db;
            margin-bottom: 25px;
            opacity: 0.7;
        }
        
        #no-manager-selected h3 {
            font-size: 24px;
            margin-bottom: 15px;
            color: #e0e0e0;
        }
        
        #no-manager-selected p {
            color: #aaa;
            max-width: 400px;
            line-height: 1.6;
            margin-bottom: 25px;
        }
        
        #no-manager-selected .btn {
            min-width: 200px;
            justify-content: center;
        }
        
        #form-title {
            color: #fff;
            font-size: 22px;
            font-weight: 600;
            margin-top: 0;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #353547;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        #form-title i {
            color: #3498db;
            font-size: 20px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 5px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #bbb;
            font-size: 14px;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 16px;
            border-radius: 6px;
            border: 1px solid #353547;
            background-color: #252537;
            color: #fff;
            box-sizing: border-box;
            font-family: inherit;
            font-size: 14px;
            transition: all 0.2s;
        }

        input:focus, select:focus, textarea:focus {
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.3);
            outline: none;
            background-color: #2a2a3c;
        }

        input:disabled, select:disabled, textarea:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }

        input[readonly] {
            background-color: #2c3e50;
            border-color: #34495e;
            font-weight: 500;
        }

        select {
            appearance: none;
            background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23FFFFFF%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E");
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 12px;
            padding-right: 40px;
        }

        .actions {
            display: flex;
            gap: 12px;
            margin-top: 30px;
            justify-content: flex-end;
        }

        .actions button {
            padding: 12px 20px;
            font-weight: 500;
            min-width: 120px;
        }

        .tabs {
            display: flex;
            margin-bottom: 25px;
            overflow-x: auto;
            scrollbar-width: thin;
            scrollbar-color: #555 #333;
            background-color: #252537;
            border-radius: 6px;
            padding: 5px;
        }

        .tab-btn {
            padding: 12px 20px;
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            font-size: 15px;
            font-weight: 500;
            transition: all 0.2s;
            white-space: nowrap;
            border-radius: 4px;
        }

        .tab-btn:hover {
            color: #ddd;
            background-color: rgba(52, 152, 219, 0.15);
        }

        .tab-btn.active {
            color: #fff;
            background-color: #3498db;
        }

        .tab-content {
            margin-top: 25px;
        }

        .tab-pane {
            display: none;
        }

        .tab-pane.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .tab-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #353547;
        }

        .tab-header h3 {
            margin: 0;
            font-size: 18px;
            color: #3498db;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tab-header h3 i {
            font-size: 16px;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .tabs {
                padding: 4px;
            }
            
            .tab-btn {
                padding: 10px 15px;
                font-size: 14px;
            }
            
            .actions {
                flex-wrap: wrap;
            }
            
            .actions button {
                flex: 1;
                min-width: 0;
                padding: 12px 10px;
                font-size: 14px;
            }
        }
    </style>

    <!-- Defer non-critical CSS -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&display=swap" media="print" onload="this.media='all'" crossorigin>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" media="print" onload="this.media='all'" crossorigin>
    <noscript>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&display=swap">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    </noscript>
</head>
<body>
    <div class="preloader">
        <div class="loader"></div>
        <p class="preloader-text">Loading...</p>
    </div>

    <header class="header">
        <div class="header-left">
        <h1><i class="fas fa-user-tie"></i> Managers Management</h1>
        </div>
        <div class="user-info" id="user-menu">
            <a href="admin-dashboard.html" class="btn">
                <i class="fas fa-th-large"></i> Dashboard
            </a>
            <span class="username-container">Logged in as: <span class="username" id="username">Admin</span></span>
            <button class="btn btn-red" id="logout-btn">
                <i class="fas fa-sign-out-alt"></i> Logout
            </button>
        </div>
        <button class="mobile-logout btn btn-red" id="mobile-logout-btn">
            <i class="fas fa-sign-out-alt"></i> Logout
        </button>
    </header>

    <div class="container">
        <div class="action-bar">
            <button class="btn btn-green" id="new-manager-btn">
                <i class="fas fa-plus"></i> Add New Manager
            </button>
            <button class="btn" id="verify-sync-btn" title="Verify data synchronization between players and squads">
                <i class="fas fa-sync"></i> Verify Player Sync
            </button>
            <button class="btn" id="verify-comp-btn" title="Verify data synchronization between seasons and competitions">
                <i class="fas fa-trophy"></i> Verify Competition Sync
            </button>
        </div>

        <div class="manager-grid">
            <div class="sidebar" id="sidebar">
                <div class="search-container">
                <input type="text" class="search-box" id="search-manager" placeholder="Search by manager or club name...">
                    <i class="fas fa-search search-icon"></i>
                </div>
                <ul class="manager-list" id="manager-list">
                    <!-- Managers will be populated here via JavaScript -->
                    <li class="manager-item">Loading managers...</li>
                </ul>
                <div class="pagination" id="pagination">
                    <!-- Pagination will be added here -->
                </div>
            </div>

            <div class="content" id="manager-form-container">
                <div id="manager-form" style="display: none;">
                    <h2 id="form-title"><i class="fas fa-edit"></i> Edit Manager</h2>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="manager-id">ID</label>
                            <input type="number" id="manager-id" readonly>
                        </div>
                        
                        <div class="form-group">
                            <label for="manager-name">Name</label>
                            <input type="text" id="manager-name" placeholder="Manager Name">
                        </div>
                        
                        <div class="form-group">
                            <label for="manager-age">Rank</label>
                            <input type="number" id="manager-age" placeholder="Manager Age">
                        </div>
                        
                        <div class="form-group">
                            <label for="manager-club">Club</label>
                            <select id="manager-club">
                                <option value="">No Club</option>
                                <!-- Clubs will be loaded via JavaScript -->
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="manager-rating">Overall Rating</label>
                            <input type="number" step="0.1" id="manager-rating" placeholder="Overall Rating">
                        </div>
                        
                        <div class="form-group">
                            <label for="manager-coins">R2G Coin Balance</label>
                            <input type="number" id="manager-coins" placeholder="R2G Coin Balance">
                        </div>
                        
                        <div class="form-group">
                            <label for="manager-tokens">R2G Token Balance</label>
                            <input type="number" id="manager-tokens" placeholder="R2G Token Balance">
                        </div>
                        
                        <div class="form-group">
                            <label for="club-value">Club Total Value</label>
                            <input type="number" id="club-value" placeholder="Club Total Value">
                        </div>
                        
                        <div class="form-group">
                            <label for="manager-manager-rating">Manager Rating</label>
                            <input type="number" step="0.1" id="manager-manager-rating" placeholder="Manager Rating">
                        </div>
                        
                        <div class="form-group">
                            <label for="manager-trophies">Trophies</label>
                            <input type="number" id="manager-trophies" placeholder="Trophies">
                        </div>
                        
                        <div class="form-group">
                            <label for="manager-awards">Awards</label>
                            <input type="number" id="manager-awards" placeholder="Awards">
                        </div>
                        
                        <div class="form-group">
                            <label for="manager-season">Current Season</label>
                            <input type="number" id="manager-season" placeholder="Current Season">
                        </div>
                        
                        <div class="form-group">
                            <label for="manager-star-rating">Star Rating</label>
                            <input type="number" id="manager-star-rating" placeholder="Star Rating">
                        </div>
                    </div>
                    
                    <div class="tabs">
                        <button class="tab-btn active" data-tab="squad">
                            <i class="fas fa-users"></i> Squad
                        </button>
                        <button class="tab-btn" data-tab="performance">
                            <i class="fas fa-chart-line"></i> Performance
                        </button>
                        <button class="tab-btn" data-tab="seasons">
                            <i class="fas fa-calendar-alt"></i> Seasons
                        </button>
                    </div>
                    
                    <div class="tab-content">
                        <div class="tab-pane active" id="squad-tab">
                            <div class="tab-header">
                                <h3><i class="fas fa-users"></i> Manager Squad</h3>
                                <button class="btn btn-green" id="add-squad-btn">
                                    <i class="fas fa-plus"></i> Add Player
                                </button>
                            </div>
                            <div id="squad-list">
                                <!-- Squad players will be listed here -->
                            </div>
                        </div>
                        
                        <div class="tab-pane" id="performance-tab">
                            <div class="tab-header">
                                <h3><i class="fas fa-chart-line"></i> Performance Statistics</h3>
                            </div>
                            <div class="performance-stats">
                                <div class="form-group">
                                    <label for="perf-matches">Matches</label>
                                    <input type="number" id="perf-matches" placeholder="Matches Played">
                                </div>
                                <div class="form-group">
                                    <label for="perf-wins">Wins</label>
                                    <input type="number" id="perf-wins" placeholder="Wins">
                                </div>
                                <div class="form-group">
                                    <label for="perf-draws">Draws</label>
                                    <input type="number" id="perf-draws" placeholder="Draws">
                                </div>
                                <div class="form-group">
                                    <label for="perf-losses">Losses</label>
                                    <input type="number" id="perf-losses" placeholder="Losses">
                                </div>
                                <div class="form-group">
                                    <label for="perf-goals-scored">Goals Scored</label>
                                    <input type="number" id="perf-goals-scored" placeholder="Goals Scored">
                                </div>
                                <div class="form-group">
                                    <label for="perf-goals-conceded">Goals Conceded</label>
                                    <input type="number" id="perf-goals-conceded" placeholder="Goals Conceded">
                                </div>
                                <div class="form-group">
                                    <label for="perf-goal-diff">Goal Difference</label>
                                    <input type="number" id="perf-goal-diff" placeholder="Goal Difference">
                                </div>
                                <div class="form-group">
                                    <label for="perf-clean-sheets">Clean Sheets</label>
                                    <input type="number" id="perf-clean-sheets" placeholder="Clean Sheets">
                                </div>
                            </div>
                        </div>
                        
                        <div class="tab-pane" id="seasons-tab">
                            <div class="tab-header">
                                <h3><i class="fas fa-calendar-alt"></i> Seasons</h3>
                                <button class="btn btn-green" id="add-season-btn">
                                    <i class="fas fa-plus"></i> Add Season
                                </button>
                            </div>
                            <div id="seasons-list">
                                <!-- Seasons will be listed here -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="actions">
                        <button class="btn" id="cancel-btn">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                        <button class="btn btn-red" id="delete-btn">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                        <button class="btn btn-green" id="save-btn">
                            <i class="fas fa-save"></i> Save
                        </button>
                    </div>
                </div>
                
                <div id="no-manager-selected" style="text-align: center; padding: 50px 0;">
                    <i class="fas fa-user-tie" style="font-size: 48px; color: #555; margin-bottom: 20px;"></i>
                    <h3>No Manager Selected</h3>
                    <p>Select a manager from the list or create a new one.</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Squad Modal -->
    <div class="modal-overlay" id="squad-modal">
        <div class="modal">
            <div class="modal-header">
                <h3><i class="fas fa-user-plus"></i> Add Squad Player</h3>
                <button class="close-modal" id="close-squad-modal">&times;</button>
            </div>
            
            <div class="form-group">
                <label for="player-select">Player</label>
                <select id="player-select">
                    <option value="">Select Player</option>
                    <!-- Players will be loaded via JavaScript -->
                </select>
            </div>
            
            <div class="form-group">
                <label for="squad-position">Position</label>
                <select id="squad-position">
                    <option value="GK">Goalkeeper (GK)</option>
                    <option value="CB">Center Back (CB)</option>
                    <option value="RB">Right Back (RB)</option>
                    <option value="LB">Left Back (LB)</option>
                    <option value="DM">Defensive Midfielder (DM)</option>
                    <option value="CM">Central Midfielder (CM)</option>
                    <option value="AM">Attacking Midfielder (AM)</option>
                    <option value="LW">Left Winger (LW)</option>
                    <option value="RW">Right Winger (RW)</option>
                    <option value="ST">Striker (ST)</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="squad-value">Value</label>
                <input type="number" id="squad-value" placeholder="Player Value">
            </div>
            
            <div class="form-group">
                <label for="squad-contract">Contract</label>
                <input type="text" id="squad-contract" placeholder="Contract Term">
            </div>
            
            <div class="form-group">
                <label for="squad-salary">Salary</label>
                <input type="number" id="squad-salary" step="0.1" placeholder="Salary">
            </div>
            
            <div class="form-group">
                <label for="squad-type">Player Type</label>
                <select id="squad-type">
                    <option value="standard">Standard</option>
                    <option value="prime">Prime</option>
                    <option value="icon">Icon</option>
                    <option value="legend">Legend</option>
                    <option value="prime legend">Prime Legend</option>
                </select>
            </div>
            
            <div class="actions">
                <button class="btn" id="cancel-squad-btn">Cancel</button>
                <button class="btn btn-green" id="save-squad-btn">Save Player</button>
            </div>
        </div>
    </div>
    
    <!-- Season Modal -->
    <div class="modal-overlay" id="season-modal">
        <div class="modal">
            <div class="modal-header">
                <h3><i class="fas fa-calendar-plus"></i> Add Season</h3>
                <button class="close-modal" id="close-season-modal">&times;</button>
            </div>
            
            <div class="form-grid">
                <div class="form-group">
                    <label for="season-number">Season Number</label>
                    <input type="number" id="season-number" placeholder="Season Number">
                </div>
                
                <div class="form-group">
                    <label for="season-rank">Manager Rank</label>
                    <input type="text" id="season-rank" placeholder="Manager Rank">
                </div>
                
                <div class="form-group">
                    <label for="season-rank-points">Rank Points</label>
                    <input type="number" step="0.1" id="season-rank-points" placeholder="Rank Points">
                </div>
                
                <div class="form-group">
                    <label for="season-income">Team Income</label>
                    <input type="number" id="season-income" placeholder="Team Income">
                </div>
                
                <div class="form-group">
                    <label for="season-expense">Team Expense</label>
                    <input type="number" id="season-expense" placeholder="Team Expense">
                </div>
                
                <div class="form-group">
                    <label for="season-profit">Team Profit</label>
                    <input type="number" id="season-profit" readonly placeholder="Team Profit">
                </div>
                
                <div class="form-group">
                    <label for="season-rewards">Session Rewards</label>
                    <input type="number" id="season-rewards" placeholder="Session Rewards">
                </div>
            </div>
            
            <h4 class="modal-section-title"><i class="fas fa-chart-bar"></i> Match Statistics</h4>
            <div class="form-grid">
                <div class="form-group">
                    <label for="season-matches">Matches Played</label>
                    <input type="number" id="season-matches" placeholder="Matches Played">
                </div>
                
                <div class="form-group">
                    <label for="season-wins">Wins</label>
                    <input type="number" id="season-wins" placeholder="Wins">
                </div>
                
                <div class="form-group">
                    <label for="season-draws">Draws</label>
                    <input type="number" id="season-draws" placeholder="Draws">
                </div>
                
                <div class="form-group">
                    <label for="season-losses">Losses</label>
                    <input type="number" id="season-losses" placeholder="Losses">
                </div>
                
                <div class="form-group">
                    <label for="season-goals-scored">Goals Scored</label>
                    <input type="number" id="season-goals-scored" placeholder="Goals Scored">
                </div>
                
                <div class="form-group">
                    <label for="season-goals-conceded">Goals Conceded</label>
                    <input type="number" id="season-goals-conceded" placeholder="Goals Conceded">
                </div>
                
                <div class="form-group">
                    <label for="season-goal-diff">Goal Difference</label>
                    <input type="number" id="season-goal-diff" readonly placeholder="Goal Difference">
                </div>
                
                <div class="form-group">
                    <label for="season-clean-sheets">Clean Sheets</label>
                    <input type="number" id="season-clean-sheets" placeholder="Clean Sheets">
                </div>
            </div>
            
            <h4 class="modal-section-title"><i class="fas fa-trophy"></i> Competitions</h4>
            <div id="competitions-container">
                <div class="competition-entry">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="competition-name-1">Competition Name</label>
                            <input type="text" id="competition-name-1" class="competition-name" placeholder="Competition Name">
                        </div>
                        
                        <div class="form-group">
                            <label for="competition-placement-1">Placement</label>
                            <input type="text" id="competition-placement-1" class="competition-placement" placeholder="Placement (e.g. 1st, 2nd)">
                        </div>
                        
                        <div class="form-group">
                            <label for="competition-stage-1">Stage</label>
                            <input type="text" id="competition-stage-1" class="competition-stage" placeholder="Stage (e.g. Division 1, Round of 32)">
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="form-group" style="margin-top: 10px;">
                <button type="button" id="add-competition-btn" class="btn btn-green" style="width: auto;">
                    <i class="fas fa-plus"></i> Add Competition
                </button>
            </div>
            
            <div class="actions">
                <button class="btn" id="cancel-season-btn">Cancel</button>
                <button class="btn btn-green" id="save-season-btn">Save Season</button>
            </div>
        </div>
    </div>
    
    <!-- Delete Confirmation Modal -->
    <div class="modal-overlay" id="delete-modal">
        <div class="modal">
            <div class="modal-header">
                <h3><i class="fas fa-exclamation-triangle"></i> Delete Manager</h3>
                <button class="close-modal" id="close-delete-modal">&times;</button>
            </div>
            
            <p>Are you sure you want to delete this manager? This action cannot be undone.</p>
            
            <div class="actions">
                <button class="btn" id="cancel-delete-btn">Cancel</button>
                <button class="btn btn-red" id="confirm-delete-btn">Delete</button>
            </div>
        </div>
    </div>
    
    <!-- Toast notification -->
    <div class="toast" id="toast"></div>
    
    <script type="module">
        import { supabase } from './supabase-client.js';
        
        document.addEventListener('DOMContentLoaded', function() {
            // Authentication check
            const isLoggedIn = sessionStorage.getItem('adminLoggedIn');
            if (!isLoggedIn) {
                window.location.href = 'admin-login.html';
                return;
            }
            
            // Set username from session storage
            const username = sessionStorage.getItem('adminUsername');
            if (username) {
                document.getElementById('username').textContent = username;
            }
            
            // DOM elements - Main
            const managerList = document.getElementById('manager-list');
            const managerForm = document.getElementById('manager-form');
            const noManagerSelected = document.getElementById('no-manager-selected');
            const formTitle = document.getElementById('form-title');
            const searchInput = document.getElementById('search-manager');
            const pagination = document.getElementById('pagination');
            const userMenu = document.getElementById('user-menu');
            const sidebar = document.getElementById('sidebar');
            
            // Tab elements
            const tabButtons = document.querySelectorAll('.tab-btn');
            const tabPanes = document.querySelectorAll('.tab-pane');
            
            // Form elements - Basic info
            const managerIdInput = document.getElementById('manager-id');
            const managerNameInput = document.getElementById('manager-name');
            const managerAgeInput = document.getElementById('manager-age');
            const managerClubSelect = document.getElementById('manager-club');
            const managerRatingInput = document.getElementById('manager-rating');
            const managerCoinsInput = document.getElementById('manager-coins');
            const managerTokensInput = document.getElementById('manager-tokens');
            const clubValueInput = document.getElementById('club-value');
            const managerManagerRatingInput = document.getElementById('manager-manager-rating');
            const managerTrophiesInput = document.getElementById('manager-trophies');
            const managerAwardsInput = document.getElementById('manager-awards');
            const managerSeasonInput = document.getElementById('manager-season');
            const managerStarRatingInput = document.getElementById('manager-star-rating');
            
            // Form elements - Performance
            const perfMatchesInput = document.getElementById('perf-matches');
            const perfWinsInput = document.getElementById('perf-wins');
            const perfDrawsInput = document.getElementById('perf-draws');
            const perfLossesInput = document.getElementById('perf-losses');
            const perfGoalsScoredInput = document.getElementById('perf-goals-scored');
            const perfGoalsConcededInput = document.getElementById('perf-goals-conceded');
            const perfGoalDiffInput = document.getElementById('perf-goal-diff');
            const perfCleanSheetsInput = document.getElementById('perf-clean-sheets');
            
            // Lists and containers
            const squadList = document.getElementById('squad-list');
            const seasonsList = document.getElementById('seasons-list');
            
            // Button elements - Main
            const newManagerBtn = document.getElementById('new-manager-btn');
            const saveBtn = document.getElementById('save-btn');
            const cancelBtn = document.getElementById('cancel-btn');
            const deleteBtn = document.getElementById('delete-btn');
            const logoutBtn = document.getElementById('logout-btn');
            const addSquadBtn = document.getElementById('add-squad-btn');
            const addSeasonBtn = document.getElementById('add-season-btn');
            
            // Squad Modal elements
            const squadModal = document.getElementById('squad-modal');
            const closeSquadModal = document.getElementById('close-squad-modal');
            const cancelSquadBtn = document.getElementById('cancel-squad-btn');
            const saveSquadBtn = document.getElementById('save-squad-btn');
            const playerSelect = document.getElementById('player-select');
            const squadPositionSelect = document.getElementById('squad-position');
            const squadValueInput = document.getElementById('squad-value');
            const squadContractInput = document.getElementById('squad-contract');
            const squadSalaryInput = document.getElementById('squad-salary');
            const squadTypeSelect = document.getElementById('squad-type');
            
            // Season Modal elements
            const seasonModal = document.getElementById('season-modal');
            const closeSeasonModal = document.getElementById('close-season-modal');
            const cancelSeasonBtn = document.getElementById('cancel-season-btn');
            const saveSeasonBtn = document.getElementById('save-season-btn');
            const seasonNumberInput = document.getElementById('season-number');
            const seasonRankInput = document.getElementById('season-rank');
            const seasonRankPointsInput = document.getElementById('season-rank-points');
            const seasonIncomeInput = document.getElementById('season-income');
            const seasonExpenseInput = document.getElementById('season-expense');
            const seasonProfitInput = document.getElementById('season-profit');
            const seasonRewardsInput = document.getElementById('season-rewards');
            // Season Match Stats elements
            const seasonMatchesInput = document.getElementById('season-matches');
            const seasonWinsInput = document.getElementById('season-wins');
            const seasonDrawsInput = document.getElementById('season-draws');
            const seasonLossesInput = document.getElementById('season-losses');
            const seasonGoalsScoredInput = document.getElementById('season-goals-scored');
            const seasonGoalsConcededInput = document.getElementById('season-goals-conceded');
            const seasonGoalDiffInput = document.getElementById('season-goal-diff');
            const seasonCleanSheetsInput = document.getElementById('season-clean-sheets');
            // Competition elements
            const competitionsContainer = document.getElementById('competitions-container');
            const addCompetitionBtn = document.getElementById('add-competition-btn');
            
            // Delete Modal elements
            const deleteModal = document.getElementById('delete-modal');
            const closeDeleteModal = document.getElementById('close-delete-modal');
            const cancelDeleteBtn = document.getElementById('cancel-delete-btn');
            const confirmDeleteBtn = document.getElementById('confirm-delete-btn');
            
            // Toast element
            const toast = document.getElementById('toast');
            
            // Variables to track state
            let managers = [];
            let currentManager = null;
            let currentManagerPerf = null;
            let managerSquad = [];
            let managerSeasons = [];
            let availablePlayers = [];
            let clubs = [];
            let editingSquadId = null;
            let editingSeasonId = null;
            let isCreatingNewManager = false;
            let currentPage = 1;
            let totalPages = 1;
            const ITEMS_PER_PAGE = 20;
            let mobileMenuOpen = false;
            let competitionCounter = 1;
            
            // Initialize the admin page
            init();
            
            async function init() {
                await loadClubs();
                await loadManagers();
                hidePreloader();
                setupEventListeners();
            }
            
            function hidePreloader() {
                const preloader = document.querySelector('.preloader');
                if (preloader) {
                    setTimeout(function() {
                        preloader.style.opacity = '0';
                        setTimeout(function() {
                            preloader.style.display = 'none';
                        }, 300);
                    }, 200);
                }
            }
            
            function setupEventListeners() {
                // Buttons
                newManagerBtn.addEventListener('click', createNewManager);
                saveBtn.addEventListener('click', saveManager);
                cancelBtn.addEventListener('click', cancelEdit);
                deleteBtn.addEventListener('click', confirmDeleteManager);
                logoutBtn.addEventListener('click', logout);
                document.getElementById('mobile-logout-btn').addEventListener('click', logout);
                addSquadBtn.addEventListener('click', openAddSquadModal);
                addSeasonBtn.addEventListener('click', openAddSeasonModal);
                
                // Add event listener for verify sync button
                document.getElementById('verify-sync-btn').addEventListener('click', verifyDataSync);
                
                // Add event listener for verify competition sync button
                document.getElementById('verify-comp-btn').addEventListener('click', verifySeasonCompetitionsSync);
                
                // Squad modal event listeners for automatic field population
                playerSelect.addEventListener('change', populatePlayerDetails);
                squadValueInput.addEventListener('input', calculateSalary);
                
                // Tab functionality
                tabButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        const tab = button.dataset.tab;
                        
                        // Remove active class from all tabs
                        tabButtons.forEach(btn => {
                            btn.classList.remove('active');
                        });
                        
                        tabPanes.forEach(pane => {
                            pane.classList.remove('active');
                        });
                        
                        // Add active class to selected tab
                        button.classList.add('active');
                        document.getElementById(`${tab}-tab`).classList.add('active');
                    });
                });
                
                // Modal buttons - Squad
                closeSquadModal.addEventListener('click', closeAddSquadModal);
                cancelSquadBtn.addEventListener('click', closeAddSquadModal);
                saveSquadBtn.addEventListener('click', saveSquadPlayer);
                
                // Modal buttons - Season
                closeSeasonModal.addEventListener('click', closeAddSeasonModal);
                cancelSeasonBtn.addEventListener('click', closeAddSeasonModal);
                saveSeasonBtn.addEventListener('click', saveSeason);
                
                // Modal buttons - Delete
                closeDeleteModal.addEventListener('click', closeDeleteConfirmation);
                cancelDeleteBtn.addEventListener('click', closeDeleteConfirmation);
                confirmDeleteBtn.addEventListener('click', deleteManager);
                
                // Search input
                searchInput.addEventListener('input', debounce(searchManagers, 300));
                
                // Calculate goal difference automatically
                perfGoalsScoredInput.addEventListener('input', calculateGoalDifference);
                perfGoalsConcededInput.addEventListener('input', calculateGoalDifference);
                
                // Calculate profit automatically
                seasonIncomeInput.addEventListener('input', calculateProfit);
                seasonExpenseInput.addEventListener('input', calculateProfit);
                
                // Season stats calculations
                seasonGoalsScoredInput.addEventListener('input', calculateSeasonGoalDifference);
                seasonGoalsConcededInput.addEventListener('input', calculateSeasonGoalDifference);
                
                // Add competition functionality
                addCompetitionBtn.addEventListener('click', addCompetitionField);
                
                // Add event delegation for removing competitions
                competitionsContainer.addEventListener('click', (e) => {
                    if (e.target.classList.contains('remove-competition') || e.target.closest('.remove-competition')) {
                        const button = e.target.classList.contains('remove-competition') ? 
                            e.target : e.target.closest('.remove-competition');
                        const competitionEntry = button.closest('.competition-entry');
                        competitionEntry.remove();
                    }
                });
                
                // Validate season match stats
                seasonMatchesInput.addEventListener('input', validateMatchStatistics);
                seasonWinsInput.addEventListener('input', validateMatchStatistics);
                seasonDrawsInput.addEventListener('input', validateMatchStatistics);
                seasonLossesInput.addEventListener('input', validateMatchStatistics);
                
                // Handle window resize
                window.addEventListener('resize', handleWindowResize);
            }
            
            // Helper function to calculate goal difference for season
            function calculateSeasonGoalDifference() {
                const goalsScored = parseInt(seasonGoalsScoredInput.value) || 0;
                const goalsConceded = parseInt(seasonGoalsConcededInput.value) || 0;
                seasonGoalDiffInput.value = goalsScored - goalsConceded;
            }
            
            // Add a new competition field to the form
            function addCompetitionField() {
                competitionCounter++;
                const newCompetition = document.createElement('div');
                newCompetition.className = 'competition-entry';
                newCompetition.innerHTML = `
                    <button type="button" class="remove-competition" title="Remove competition">
                        <i class="fas fa-times"></i>
                    </button>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="competition-name-${competitionCounter}">Competition Name</label>
                            <input type="text" id="competition-name-${competitionCounter}" class="competition-name" placeholder="Competition Name">
                        </div>
                        
                        <div class="form-group">
                            <label for="competition-placement-${competitionCounter}">Placement</label>
                            <input type="text" id="competition-placement-${competitionCounter}" class="competition-placement" placeholder="Placement (e.g. 1st, 2nd)">
                        </div>
                        
                        <div class="form-group">
                            <label for="competition-stage-${competitionCounter}">Stage</label>
                            <input type="text" id="competition-stage-${competitionCounter}" class="competition-stage" placeholder="Stage (e.g. Division 1, Round of 32)">
                        </div>
                    </div>
                `;
                competitionsContainer.appendChild(newCompetition);
            }
            
            // Clear competition fields
            function clearCompetitionFields() {
                competitionsContainer.innerHTML = `
                    <div class="competition-entry">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="competition-name-1">Competition Name</label>
                                <input type="text" id="competition-name-1" class="competition-name" placeholder="Competition Name">
                            </div>
                            
                            <div class="form-group">
                                <label for="competition-placement-1">Placement</label>
                                <input type="text" id="competition-placement-1" class="competition-placement" placeholder="Placement (e.g. 1st, 2nd)">
                            </div>
                            
                            <div class="form-group">
                                <label for="competition-stage-1">Stage</label>
                                <input type="text" id="competition-stage-1" class="competition-stage" placeholder="Stage (e.g. Division 1, Round of 32)">
                            </div>
                        </div>
                    </div>
                `;
                competitionCounter = 1;
            }
            
            // Validate that wins + draws + losses = matches
            function validateMatchStatistics() {
                const matches = parseInt(seasonMatchesInput.value) || 0;
                const wins = parseInt(seasonWinsInput.value) || 0;
                const draws = parseInt(seasonDrawsInput.value) || 0;
                const losses = parseInt(seasonLossesInput.value) || 0;
                
                const totalResults = wins + draws + losses;
                
                if (matches > 0 && totalResults > 0 && matches !== totalResults) {
                    showToast(`Warning: Wins (${wins}) + Draws (${draws}) + Losses (${losses}) = ${totalResults}, which doesn't match total Matches (${matches})`, 'error');
                }
            }
            
            // Load clubs from Supabase
            async function loadClubs() {
                try {
                    const { data: clubData, error } = await supabase
                        .from('clubs')
                        .select('id, name')
                        .order('name');
                        
                    if (error) throw error;
                    
                    clubs = clubData;
                    
                    // Clear existing options (except No Club)
                    managerClubSelect.innerHTML = '<option value="">No Club</option>';
                    
                    // Add club options
                    clubs.forEach(club => {
                        const option = document.createElement('option');
                        option.value = club.id;
                        option.textContent = club.name;
                        managerClubSelect.appendChild(option);
                    });
                } catch (error) {
                    showToast('Error loading clubs: ' + error.message, 'error');
                }
            }
            
            // Load managers from Supabase with pagination
            async function loadManagers(page = 1, searchTerm = '') {
                try {
                    let query = supabase.from('managers').select('id, name, club_id', { count: 'exact' });
                    
                    if (searchTerm) {
                        // First get club IDs that match the search term
                        const matchingClubIds = await getClubIdsByName(searchTerm);
                        
                        // Modify query to search by manager name or club name
                        query = query.or(`name.ilike.%${searchTerm}%,club_id.in.(${matchingClubIds})`);
                    }
                    
                    // Calculate pagination
                    const from = (page - 1) * ITEMS_PER_PAGE;
                    const to = from + ITEMS_PER_PAGE - 1;
                    
                    const { data, error, count } = await query
                        .order('name')
                        .range(from, to);
                        
                    if (error) throw error;
                    
                    managers = data;
                    
                    // Load club info for each manager
                    if (managers.length > 0) {
                        const managerClubIds = managers.filter(m => m.club_id).map(m => m.club_id);
                        
                        if (managerClubIds.length > 0) {
                            const { data: managerClubs, error: clubsError } = await supabase
                                .from('clubs')
                                .select('id, name')
                                .in('id', managerClubIds);
                                
                            if (clubsError) throw clubsError;
                            
                            // Add club names and logos to managers
                            managers.forEach(manager => {
                                if (manager.club_id) {
                                    const club = managerClubs.find(c => c.id === manager.club_id);
                                    manager.club_name = club ? club.name : 'Unknown Club';
                                    
                                    // Generate club logo URL from club name
                                    if (club && club.name) {
                                        // Format club name to match logo file naming convention
                                        const logoName = club.name.toUpperCase()
                                            .replace(/\s+/g, '-')  // Replace spaces with hyphens
                                            .replace(/[^\w-]/g, '') // Remove special characters
                                            + '.webp';
                                        
                                        manager.club_logo = `assets/images/club-logos/${logoName}`;
                                    } else {
                                        // Use free agent logo if no club
                                        manager.club_logo = 'assets/images/club-logos/FREE-AGENT.WEBP';
                                    }
                                } else {
                                    // Use free agent logo if no club_id
                                    manager.club_logo = 'assets/images/club-logos/FREE-AGENT.WEBP';
                                }
                            });
                        }
                    }
                    
                    // Update pagination info
                    if (count !== null) {
                        totalPages = Math.ceil(count / ITEMS_PER_PAGE);
                        currentPage = page;
                        updatePagination();
                    }
                    
                    renderManagerList();
                } catch (error) {
                    showToast('Error loading managers: ' + error.message, 'error');
                    managerList.innerHTML = '<li class="manager-item">Error loading managers</li>';
                }
            }
            
            // Helper function to get club IDs by name
            async function getClubIdsByName(searchTerm) {
                try {
                    // Search for clubs with names matching the search term
                    const { data, error } = await supabase
                        .from('clubs')
                        .select('id')
                        .ilike('name', `%${searchTerm}%`);
                        
                    if (error) throw error;
                    
                    if (!data || data.length === 0) {
                        return '0'; // Return 0 as a fallback ID that won't match anything
                    }
                    
                    // Return comma-separated list of club IDs
                    return data.map(club => club.id).join(',');
                } catch (error) {
                    console.error('Error searching clubs:', error);
                    return '0'; // Return 0 as a fallback ID that won't match anything
                }
            }
            
            // Render manager list
            function renderManagerList() {
                if (managers.length === 0) {
                    managerList.innerHTML = '<li class="manager-item">No managers found</li>';
                    return;
                }
                
                managerList.innerHTML = '';
                
                managers.forEach(manager => {
                    const listItem = document.createElement('li');
                    listItem.className = 'manager-item';
                    if (currentManager && manager.id === currentManager.id) {
                        listItem.classList.add('selected');
                    }
                    
                    // Use club logo if available, otherwise use initials
                    const initials = manager.name ? manager.name.charAt(0).toUpperCase() : 'M';
                    const clubPhoto = manager.club_logo ? manager.club_logo : null;
                    
                    // Create div for manager details
                    listItem.innerHTML = `
                        <div class="manager-icon" ${clubPhoto ? `style="background-image: url('${clubPhoto}');"` : ''}>
                            ${initials}
                        </div>
                        <div class="manager-details">
                            <div class="manager-name">${manager.name}</div>
                            ${manager.club_name ? `<div class="manager-club"><i class="fas fa-shield-alt"></i> ${manager.club_name}</div>` : ''}
                        </div>
                    `;
                    
                    // Handle image loading errors - fall back to initials
                    if (clubPhoto) {
                        const iconDiv = listItem.querySelector('.manager-icon');
                        const img = new Image();
                        img.onload = () => {
                            iconDiv.textContent = ''; // Clear the initials if image loads
                        };
                        img.onerror = () => {
                            iconDiv.style.backgroundImage = ''; // Clear the background image
                            iconDiv.style.backgroundColor = '#3498db'; // Set fallback color
                            iconDiv.style.color = '#fff'; // Ensure initials are visible
                            iconDiv.style.fontSize = '16px'; // Adjust font size for initials
                        };
                        img.src = clubPhoto;
                    }
                    
                    listItem.addEventListener('click', () => selectManager(manager.id));
                    
                    managerList.appendChild(listItem);
                });
            }
            
            // Update pagination controls
            function updatePagination() {
                pagination.innerHTML = '';
                
                // Only show pagination if we have more than one page
                if (totalPages <= 1) {
                    return;
                }
                
                // Previous button
                const prevBtn = document.createElement('button');
                prevBtn.innerHTML = '<i class="fas fa-chevron-left"></i>';
                prevBtn.disabled = currentPage === 1;
                prevBtn.addEventListener('click', () => {
                    if (currentPage > 1) {
                        loadManagers(currentPage - 1, searchInput.value);
                    }
                });
                pagination.appendChild(prevBtn);
                
                // Page numbers
                let startPage = Math.max(1, currentPage - 2);
                let endPage = Math.min(totalPages, startPage + 4);
                if (endPage - startPage < 4) {
                    startPage = Math.max(1, endPage - 4);
                }
                
                for (let i = startPage; i <= endPage; i++) {
                    const pageBtn = document.createElement('button');
                    pageBtn.textContent = i;
                    if (i === currentPage) {
                        pageBtn.classList.add('active');
                    }
                    pageBtn.addEventListener('click', () => loadManagers(i, searchInput.value));
                    pagination.appendChild(pageBtn);
                }
                
                // Next button
                const nextBtn = document.createElement('button');
                nextBtn.innerHTML = '<i class="fas fa-chevron-right"></i>';
                nextBtn.disabled = currentPage === totalPages;
                nextBtn.addEventListener('click', () => {
                    if (currentPage < totalPages) {
                        loadManagers(currentPage + 1, searchInput.value);
                    }
                });
                pagination.appendChild(nextBtn);
            }
            
            // Helper function to calculate goal difference
            function calculateGoalDifference() {
                const goalsScored = parseInt(perfGoalsScoredInput.value) || 0;
                const goalsConceded = parseInt(perfGoalsConcededInput.value) || 0;
                perfGoalDiffInput.value = goalsScored - goalsConceded;
            }
            
            // Helper function to calculate profit
            function calculateProfit() {
                const income = parseInt(seasonIncomeInput.value) || 0;
                const expense = parseInt(seasonExpenseInput.value) || 0;
                seasonProfitInput.value = income - expense;
            }
            
            // Search managers
            function searchManagers() {
                const searchTerm = searchInput.value;
                loadManagers(1, searchTerm); // Reset to page 1 when searching
            }
            
            // Logout
            function logout() {
                sessionStorage.removeItem('adminLoggedIn');
                sessionStorage.removeItem('adminUsername');
                window.location.href = 'admin-login.html';
            }
            
            // Show toast message
            function showToast(message, type = 'success') {
                toast.textContent = message;
                toast.className = 'toast ' + type + ' show';
                
                // Add icon based on type
                if (type === 'success') {
                    toast.setAttribute('aria-label', 'Success');
                } else if (type === 'error') {
                    toast.setAttribute('aria-label', 'Error');
                }
                
                // Hide toast after 3 seconds
                setTimeout(() => {
                    toast.className = 'toast';
                }, 3000);
            }
            
            // Debounce function for search input
            function debounce(func, delay) {
                let timeout;
                return function() {
                    const context = this;
                    const args = arguments;
                    clearTimeout(timeout);
                    timeout = setTimeout(() => func.apply(context, args), delay);
                };
            }
            
            // Select manager and load details
            async function selectManager(managerId) {
                try {
                    // Get manager info
                    const { data, error } = await supabase
                        .from('managers')
                        .select('*')
                        .eq('id', managerId)
                        .single();
                        
                    if (error) throw error;
                    
                    // Get manager performance data
                    const { data: perfData, error: perfError } = await supabase
                        .from('manager_performances')
                        .select('*')
                        .eq('manager_id', managerId)
                        .single();
                        
                    if (perfError && perfError.code !== 'PGRST116') { // PGRST116 = no rows returned
                        throw perfError;
                    }
                    
                    // Set current manager data
                    currentManager = data;
                    currentManagerPerf = perfData || null;
                    
                    // Update UI to show details
                    noManagerSelected.style.display = 'none';
                    managerForm.style.display = 'block';
                    formTitle.textContent = 'Edit Manager: ' + currentManager.name;
                    
                    // Populate the form fields - Basic info
                    managerIdInput.value = currentManager.id;
                    managerNameInput.value = currentManager.name || '';
                    managerAgeInput.value = currentManager.age || '';
                    managerClubSelect.value = currentManager.club_id || '';
                    managerRatingInput.value = currentManager.overall_rating || '0';
                    managerCoinsInput.value = currentManager.r2g_coin_balance || '0';
                    managerTokensInput.value = currentManager.r2g_token_balance || '0';
                    clubValueInput.value = currentManager.club_total_value || '0';
                    managerManagerRatingInput.value = currentManager.manager_rating || '';
                    managerTrophiesInput.value = currentManager.trophies || '0';
                    managerAwardsInput.value = currentManager.awards || '0';
                    managerSeasonInput.value = currentManager.current_season || '0';
                    managerStarRatingInput.value = currentManager.star_rating || '0';
                    
                    // Populate performance data if available
                    if (currentManagerPerf) {
                        perfMatchesInput.value = currentManagerPerf.matches || '0';
                        perfWinsInput.value = currentManagerPerf.wins || '0';
                        perfDrawsInput.value = currentManagerPerf.draws || '0';
                        perfLossesInput.value = currentManagerPerf.losses || '0';
                        perfGoalsScoredInput.value = currentManagerPerf.goals_scored || '0';
                        perfGoalsConcededInput.value = currentManagerPerf.goals_conceded || '0';
                        perfGoalDiffInput.value = currentManagerPerf.goal_difference || '0';
                        perfCleanSheetsInput.value = currentManagerPerf.clean_sheets || '0';
                    } else {
                        // Clear performance fields if no data
                        perfMatchesInput.value = '';
                        perfWinsInput.value = '';
                        perfDrawsInput.value = '';
                        perfLossesInput.value = '';
                        perfGoalsScoredInput.value = '';
                        perfGoalsConcededInput.value = '';
                        perfGoalDiffInput.value = '';
                        perfCleanSheetsInput.value = '';
                    }
                    
                    // Enable delete button
                    deleteBtn.disabled = false;
                    
                    // Refresh the squad and seasons lists
                    loadManagerSquad(managerId);
                    loadManagerSeasons(managerId);
                    
                    // Refresh selected item in list
                    renderManagerList();
                    
                    // Reset the form state
                    isCreatingNewManager = false;
                } catch (error) {
                    showToast('Error loading manager details: ' + error.message, 'error');
                }
            }
            
            // Create new manager
            function createNewManager() {
                // Clear form and set default values
                managerIdInput.value = '';
                managerNameInput.value = '';
                managerAgeInput.value = '';
                managerClubSelect.value = '';
                managerRatingInput.value = '50';
                managerCoinsInput.value = '0';
                managerTokensInput.value = '0';
                clubValueInput.value = '0';
                managerManagerRatingInput.value = '50';
                managerTrophiesInput.value = '0';
                managerAwardsInput.value = '0';
                managerSeasonInput.value = '1';
                managerStarRatingInput.value = '1';
                
                // Clear performance fields
                perfMatchesInput.value = '0';
                perfWinsInput.value = '0';
                perfDrawsInput.value = '0';
                perfLossesInput.value = '0';
                perfGoalsScoredInput.value = '0';
                perfGoalsConcededInput.value = '0';
                perfGoalDiffInput.value = '0';
                perfCleanSheetsInput.value = '0';
                
                // Show form
                noManagerSelected.style.display = 'none';
                managerForm.style.display = 'block';
                formTitle.textContent = 'Create New Manager';
                
                // Clear squad and seasons lists
                squadList.innerHTML = '<li class="empty-message">Save manager first to add squad members</li>';
                seasonsList.innerHTML = '<li class="empty-message">Save manager first to add seasons</li>';
                
                // Disable delete button
                deleteBtn.disabled = true;
                
                // Set form state
                isCreatingNewManager = true;
                currentManager = null;
                currentManagerPerf = null;
            }
            
            // Save manager
            async function saveManager() {
                try {
                    if (!managerNameInput.value) {
                        showToast('Manager name is required', 'error');
                        return;
                    }
                    
                    // Prepare manager data
                    const managerData = {
                        name: managerNameInput.value,
                        age: parseInt(managerAgeInput.value) || null,
                        club_id: managerClubSelect.value || null,
                        overall_rating: parseInt(managerRatingInput.value) || null,
                        r2g_coin_balance: parseInt(managerCoinsInput.value) || 0,
                        r2g_token_balance: parseInt(managerTokensInput.value) || 0,
                        club_total_value: parseInt(clubValueInput.value) || 0,
                        manager_rating: parseInt(managerManagerRatingInput.value) || null,
                        trophies: parseInt(managerTrophiesInput.value) || 0,
                        awards: parseInt(managerAwardsInput.value) || 0,
                        current_season: parseInt(managerSeasonInput.value) || 1,
                        star_rating: parseInt(managerStarRatingInput.value) || 1
                    };
                    
                    // Prepare performance data
                    const perfData = {
                        matches: parseInt(perfMatchesInput.value) || 0,
                        wins: parseInt(perfWinsInput.value) || 0,
                        draws: parseInt(perfDrawsInput.value) || 0,
                        losses: parseInt(perfLossesInput.value) || 0,
                        goals_scored: parseInt(perfGoalsScoredInput.value) || 0,
                        goals_conceded: parseInt(perfGoalsConcededInput.value) || 0,
                        goal_difference: parseInt(perfGoalDiffInput.value) || 0,
                        clean_sheets: parseInt(perfCleanSheetsInput.value) || 0
                    };
                    
                    let managerId;
                    
                    if (isCreatingNewManager) {
                        // Create new manager
                        const { data, error } = await supabase
                            .from('managers')
                            .insert([managerData])
                            .select()
                            .single();
                            
                        if (error) throw error;
                        
                        managerId = data.id;
                        showToast('Manager created successfully');
                    } else {
                        // Update existing manager
                        managerId = managerIdInput.value;
                        
                        const { error } = await supabase
                            .from('managers')
                            .update(managerData)
                            .eq('id', managerId);
                            
                        if (error) throw error;
                        
                        showToast('Manager updated successfully');
                    }
                    
                    // Save performance data
                    perfData.manager_id = managerId;
                    
                    if (currentManagerPerf) {
                        // Update existing performance record
                        const { error: perfError } = await supabase
                            .from('manager_performances')
                            .update(perfData)
                            .eq('manager_id', managerId);
                            
                        if (perfError) throw perfError;
                    } else {
                        // Create new performance record
                        const { error: perfError } = await supabase
                            .from('manager_performances')
                            .insert([perfData]);
                            
                        if (perfError) throw perfError;
                    }
                    
                    // Refresh manager list and select the saved manager
                    await loadManagers(currentPage, searchInput.value);
                    await selectManager(managerId);
                } catch (error) {
                    showToast('Error saving manager: ' + error.message, 'error');
                }
            }
            
            // Cancel edit
            function cancelEdit() {
                if (currentManager) {
                    // Revert to current manager data
                    selectManager(currentManager.id);
                } else {
                    // Hide form
                    managerForm.style.display = 'none';
                    noManagerSelected.style.display = 'flex';
                }
            }
            
            // Confirm delete manager
            function confirmDeleteManager() {
                if (!currentManager) return;
                
                // Show delete confirmation modal
                deleteModal.classList.add('active');
            }
            
            // Close delete confirmation
            function closeDeleteConfirmation() {
                deleteModal.classList.remove('active');
            }
            
            // Delete manager
            async function deleteManager() {
                if (!currentManager) return;
                
                try {
                    // Delete manager squad
                    const { error: squadError } = await supabase
                        .from('manager_squads')
                        .delete()
                        .eq('manager_id', currentManager.id);
                        
                    if (squadError) throw squadError;
                    
                    // Delete manager seasons
                    const { error: seasonsError } = await supabase
                        .from('seasons')
                        .delete()
                        .eq('manager_id', currentManager.id);
                        
                    if (seasonsError) throw seasonsError;
                    
                    // Delete manager performance
                    const { error: perfError } = await supabase
                        .from('manager_performances')
                        .delete()
                        .eq('manager_id', currentManager.id);
                        
                    if (perfError && perfError.code !== 'PGRST116') throw perfError;
                    
                    // Delete manager
                    const { error } = await supabase
                        .from('managers')
                        .delete()
                        .eq('id', currentManager.id);
                        
                    if (error) throw error;
                    
                    // Close modal
                    closeDeleteConfirmation();
                    
                    // Refresh manager list
                    await loadManagers(currentPage, searchInput.value);
                    
                    // Hide form
                    managerForm.style.display = 'none';
                    noManagerSelected.style.display = 'flex';
                    
                    // Reset current manager
                    currentManager = null;
                    currentManagerPerf = null;
                    
                    showToast('Manager deleted successfully');
                } catch (error) {
                    showToast('Error deleting manager: ' + error.message, 'error');
                    closeDeleteConfirmation();
                }
            }
            
            // Load manager squad
            async function loadManagerSquad(managerId) {
                try {
                    squadList.innerHTML = '<li class="loading">Loading squad...</li>';
                    
                    // First get the squad data
                    const { data, error } = await supabase
                        .from('manager_squads')
                        .select('*')
                        .eq('manager_id', managerId)
                        .order('id');
                        
                    if (error) throw error;
                    
                    if (data && data.length > 0) {
                        // Then load the player details separately
                        const playerIds = data.map(squad => squad.player_id).filter(id => id !== null);
                        
                        if (playerIds.length > 0) {
                            // Get player details
                            const { data: playerData, error: playerError } = await supabase
                                .from('players')
                                .select('id, name, position, value')
                                .in('id', playerIds);
                                
                            if (playerError) throw playerError;
                            
                            // Check for data mismatches and fix them automatically
                            const syncUpdates = [];
                            
                            for (const squad of data) {
                                if (!squad.player_id) continue;
                                
                                const player = playerData.find(p => p.id === squad.player_id);
                                if (!player) continue;
                                
                                const needsUpdate = 
                                    squad.player_name !== player.name || 
                                    squad.position !== player.position || 
                                    squad.value !== player.value;
                                    
                                if (needsUpdate) {
                                    // Queue update
                                    syncUpdates.push({
                                        id: squad.id,
                                        updates: {
                                            player_name: player.name,
                                            position: player.position,
                                            value: player.value
                                        }
                                    });
                                }
                            }
                            
                            // Apply updates if needed
                            if (syncUpdates.length > 0) {
                                console.log(`Auto-syncing ${syncUpdates.length} squad entries with player data...`);
                                
                                // Apply updates one by one
                                for (const update of syncUpdates) {
                                    try {
                                        await supabase
                                            .from('manager_squads')
                                            .update(update.updates)
                                            .eq('id', update.id);
                                            
                                        console.log(`Auto-synced squad ID ${update.id}`);
                                    } catch (updateError) {
                                        console.error(`Error auto-syncing squad ID ${update.id}:`, updateError);
                                    }
                                }
                                
                                // Reload squad data after updates
                                const { data: refreshedData, error: refreshError } = await supabase
                                    .from('manager_squads')
                                    .select('*')
                                    .eq('manager_id', managerId)
                                    .order('id');
                                    
                                if (!refreshError) {
                                    data.splice(0, data.length, ...refreshedData);
                                }
                                
                                // Show toast about auto-sync
                                showToast(`Auto-synchronized ${syncUpdates.length} squad entries with player data`, 'success');
                            }
                            
                            // Combine the data
                            managerSquad = data.map(squad => {
                                const player = playerData.find(p => p.id === squad.player_id);
                                return {
                                    ...squad,
                                    players: player
                                };
                            });
                        } else {
                            managerSquad = data;
                        }
                    } else {
                        managerSquad = data || [];
                    }
                    
                    renderSquadList();
                    
                    // Also load available players for the squad modal
                    await loadAvailablePlayers();
                } catch (error) {
                    showToast('Error loading manager squad: ' + error.message, 'error');
                    squadList.innerHTML = '<li class="error">Error loading squad</li>';
                }
            }
            
            // Load manager seasons
            async function loadManagerSeasons(managerId) {
                try {
                    seasonsList.innerHTML = '<li class="loading">Loading seasons...</li>';
                    
                    // Get basic season data
                    const { data: seasonsData, error } = await supabase
                        .from('seasons')
                        .select('*')
                        .eq('manager_id', managerId)
                        .order('number');
                        
                    if (error) throw error;
                    
                    if (!seasonsData || seasonsData.length === 0) {
                        managerSeasons = [];
                        renderSeasonsList();
                        return;
                    }
                    
                    // Extract season IDs
                    const seasonIds = seasonsData.map(season => season.id);
                    
                    // Get season stats
                    const { data: statsData, error: statsError } = await supabase
                        .from('season_stats')
                        .select('*')
                        .in('season_id', seasonIds);
                        
                    if (statsError) throw statsError;
                    
                    // Get competitions data - first get all competitions from the competitions table
                    const { data: allCompetitions, error: allCompError } = await supabase
                        .from('competitions')
                        .select('id, name');
                        
                    if (allCompError) throw allCompError;
                    
                    // Now get the season_competitions data
                    const { data: seasonCompData, error: compError } = await supabase
                        .from('season_competitions')
                        .select('id, season_id, competition_id, placement, stage')
                        .in('season_id', seasonIds);
                        
                    if (compError) throw compError;
                    
                    // Combine the data
                    managerSeasons = seasonsData.map(season => {
                        // Find stats for this season
                        const stats = statsData?.find(s => s.season_id === season.id) || {};
                        
                        // Find competitions for this season and join with competitions data
                        const seasonComps = seasonCompData?.filter(c => c.season_id === season.id) || [];
                        const competitions = seasonComps.map(sc => {
                            const competitionData = allCompetitions.find(c => c.id === sc.competition_id);
                            return {
                                id: sc.competition_id,
                                name: competitionData?.name || 'Unknown Competition',
                                placement: sc.placement,
                                stage: sc.stage
                            };
                        });
                        
                        // Return combined data
                        return {
                            ...season,
                            ...stats,
                            competitions
                        };
                    });
                    
                    renderSeasonsList();
                } catch (error) {
                    showToast('Error loading manager seasons: ' + error.message, 'error');
                    seasonsList.innerHTML = '<li class="error">Error loading seasons</li>';
                    console.error('Error loading seasons:', error);
                }
            }
            
            // Render seasons list
            function renderSeasonsList() {
                if (!managerSeasons || managerSeasons.length === 0) {
                    seasonsList.innerHTML = '<div class="empty-message">No seasons data</div>';
                    return;
                }
                
                seasonsList.innerHTML = '';
                
                managerSeasons.forEach(season => {
                    const listItem = document.createElement('div');
                    listItem.className = 'season-item';
                    
                    // Prepare competitions HTML if available
                    let competitionsHTML = '';
                    if (season.competitions && Array.isArray(season.competitions) && season.competitions.length > 0) {
                        competitionsHTML = `
                            <div class="season-competitions">
                                <div class="season-competition-title">
                                    <i class="fas fa-trophy"></i> Competitions
                                </div>
                                ${season.competitions.map(comp => {
                                    const placementText = comp.placement || '';
                                    const stageText = comp.stage || '';
                                    let displayText = '';
                                    
                                    if (placementText && stageText) {
                                        displayText = `${placementText} - ${stageText}`;
                                    } else if (placementText) {
                                        displayText = placementText;
                                    } else if (stageText) {
                                        displayText = stageText;
                                    } else {
                                        displayText = 'N/A';
                                    }
                                    
                                    return `
                                    <div class="season-competition-item">
                                        <div class="competition-name">${comp.name || 'Unknown'}</div>
                                        <div class="competition-position">${displayText}</div>
                                    </div>`;
                                }).join('')}
                            </div>
                        `;
                    }
                    
                    listItem.innerHTML = `
                        <div class="season-header">
                            <div class="season-number">Season ${season.number}</div>
                            <div class="season-actions">
                                <button class="edit-btn" title="Edit season" data-id="${season.id}">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="delete-btn" title="Delete season" data-id="${season.id}">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="season-sections">
                            <div class="season-section">
                                <div class="season-section-title">
                                    <i class="fas fa-info-circle"></i> General Information
                                </div>
                                <div class="season-rank">${season.manager_rank || 'No Rank'}</div>
                                <div class="season-points"><i class="fas fa-star"></i> Points: ${season.rank_point || '0'}</div>
                                <div class="season-finance">
                                    <span><i class="fas fa-arrow-down"></i> Income: ${season.team_income ? season.team_income.toLocaleString() : 0}</span>
                                    <span><i class="fas fa-arrow-up"></i> Expense: ${season.team_expense ? season.team_expense.toLocaleString() : 0}</span>
                                    <span><i class="fas fa-calculator"></i> Profit: ${season.team_profit ? season.team_profit.toLocaleString() : 0}</span>
                                </div>
                                <div class="season-rewards"><i class="fas fa-gift"></i> Rewards: ${season.session_rewards || '0'}</div>
                            </div>
                            
                            <div class="season-section">
                                <div class="season-section-title">
                                    <i class="fas fa-chart-line"></i> Match Statistics
                                </div>
                                <div class="season-stats-grid">
                                    <div class="season-stat-item">
                                        <div class="season-stat-value">${season.matches || '0'}</div>
                                        <div class="season-stat-label">Matches</div>
                                    </div>
                                    <div class="season-stat-item">
                                        <div class="season-stat-value">${season.wins || '0'}</div>
                                        <div class="season-stat-label">Wins</div>
                                    </div>
                                    <div class="season-stat-item">
                                        <div class="season-stat-value">${season.draws || '0'}</div>
                                        <div class="season-stat-label">Draws</div>
                                    </div>
                                    <div class="season-stat-item">
                                        <div class="season-stat-value">${season.losses || '0'}</div>
                                        <div class="season-stat-label">Losses</div>
                                    </div>
                                </div>
                                
                                <div class="season-details">
                                    <div class="season-detail">
                                        <div class="season-label">Goals Scored:</div>
                                        <div class="season-value">${season.goals_scored || '0'}</div>
                                    </div>
                                    <div class="season-detail">
                                        <div class="season-label">Goals Conceded:</div>
                                        <div class="season-value">${season.goals_conceded || '0'}</div>
                                    </div>
                                    <div class="season-detail">
                                        <div class="season-label">Goal Difference:</div>
                                        <div class="season-value">${season.goal_difference || '0'}</div>
                                    </div>
                                    <div class="season-detail">
                                        <div class="season-label">Clean Sheets:</div>
                                        <div class="season-value">${season.clean_sheets || '0'}</div>
                                    </div>
                                </div>
                                
                                ${competitionsHTML}
                            </div>
                        </div>
                    `;
                    
                    // Add event listeners
                    const editBtn = listItem.querySelector('.edit-btn');
                    const deleteBtn = listItem.querySelector('.delete-btn');
                    
                    editBtn.addEventListener('click', () => editSeason(season.id));
                    deleteBtn.addEventListener('click', () => deleteSeason(season.id));
                    
                    seasonsList.appendChild(listItem);
                });
            }
            
            // Load available players
            async function loadAvailablePlayers() {
                try {
                    const { data, error } = await supabase
                        .from('players')
                        .select('id, name, position, value')
                        .order('name');
                        
                    if (error) throw error;
                    
                    availablePlayers = data;
                    
                    // Update player select in squad modal
                    playerSelect.innerHTML = '<option value="">Select Player</option>';
                    
                    // Identify which players are already in the current manager's squad
                    const squadPlayerIds = managerSquad ? managerSquad.map(squad => squad.player_id) : [];
                    
                    // If editing, get the current player's ID
                    let editingPlayerId = null;
                    if (editingSquadId) {
                        const editingSquad = managerSquad.find(p => p.id === editingSquadId);
                        if (editingSquad) {
                            editingPlayerId = editingSquad.player_id;
                        }
                    }
                    
                    availablePlayers.forEach(player => {
                        const option = document.createElement('option');
                        option.value = player.id;
                        option.textContent = `${player.name} (${player.position})`;
                        
                        // Check if player is already in the squad (but not the player being edited)
                        const alreadyInSquad = squadPlayerIds.includes(player.id);
                        const isPlayerBeingEdited = player.id === editingPlayerId;
                        
                        if (alreadyInSquad && !isPlayerBeingEdited) {
                            option.disabled = true;
                            option.textContent += ' - Already in Squad';
                        }
                        
                        playerSelect.appendChild(option);
                    });
                } catch (error) {
                    showToast('Error loading players: ' + error.message, 'error');
                }
            }
            
            // Open add squad player modal
            function openAddSquadModal() {
                if (!currentManager) {
                    showToast('Please save the manager first', 'error');
                    return;
                }
                
                // Reset form values
                playerSelect.value = '';
                squadPositionSelect.value = '';
                squadValueInput.value = '';
                squadContractInput.value = '';
                squadSalaryInput.value = '';
                squadTypeSelect.value = 'standard';
                
                // Set default contract value to current season
                const currentSeason = currentManager.current_season || 1;
                squadContractInput.value = `SEASON ${currentSeason}`;
                
                // Reset editing state
                editingSquadId = null;
                
                // Reload available players to update the disabled status
                loadAvailablePlayers();
                
                // Show modal
                squadModal.classList.add('active');
            }
            
            // Close add squad player modal
            function closeAddSquadModal() {
                squadModal.classList.remove('active');
            }
            
            // Edit squad player
            function editSquadPlayer(squadId) {
                const player = managerSquad.find(p => p.id === squadId);
                if (!player) return;
                
                // Set editing state
                editingSquadId = squadId;
                
                // Reload available players first (this will properly handle disabling/enabling options)
                loadAvailablePlayers().then(() => {
                    // Populate form with player data
                    playerSelect.value = player.player_id;
                    squadPositionSelect.value = player.position || '';
                    squadValueInput.value = player.value || '';
                    squadContractInput.value = player.contract || '';
                    squadSalaryInput.value = player.salary || '';
                    squadTypeSelect.value = player.player_type || 'standard';
                    
                    // If salary is not set but value is, calculate it
                    if ((!player.salary || player.salary === 0) && player.value) {
                        calculateSalary();
                    }
                });
                
                // Show modal
                squadModal.classList.add('active');
            }
            
            // Save squad player
            async function saveSquadPlayer() {
                if (!currentManager) {
                    showToast('No manager selected', 'error');
                    return;
                }
                
                if (!playerSelect.value) {
                    showToast('Please select a player', 'error');
                    return;
                }
                
                try {
                    // Get selected player details
                    const selectedPlayerId = playerSelect.value;
                    const selectedPlayerInfo = availablePlayers.find(p => p.id == selectedPlayerId);
                    
                    // Check if player is already in the squad (only for new additions, not edits)
                    if (!editingSquadId) {
                        const playerAlreadyInSquad = managerSquad.some(p => p.player_id == selectedPlayerId);
                        
                        if (playerAlreadyInSquad) {
                            showToast('This player is already in the squad', 'error');
                            return;
                        }
                    }
                    
                    // Get player name from the selected player info
                    const playerName = selectedPlayerInfo ? selectedPlayerInfo.name : 'Unknown Player';
                    
                    // Gather squad data
                    const squadData = {
                        manager_id: currentManager.id,
                        player_id: selectedPlayerId,
                        player_name: playerName, // Always include player_name
                        position: squadPositionSelect.value || null,
                        value: parseInt(squadValueInput.value) || null,
                        contract: squadContractInput.value || null,
                        salary: parseInt(squadSalaryInput.value) || null,
                        player_type: squadTypeSelect.value
                    };
                    
                    // Prepare player update data - make sure we keep both tables in sync
                    const playerUpdateData = {
                        position: squadPositionSelect.value || null,
                        value: parseInt(squadValueInput.value) || null,
                        // Get club_id from the current manager
                        club_id: currentManager.club_id
                    };
                    
                    // Update both tables in sequence
                    
                    // 1. First, update the player in players table
                    console.log('Updating player data first:', playerUpdateData);
                    
                    const { error: playerUpdateError } = await supabase
                        .from('players')
                        .update(playerUpdateData)
                        .eq('id', selectedPlayerId);
                        
                    if (playerUpdateError) {
                        console.error('Error updating player details:', playerUpdateError);
                        showToast('Warning: Player update failed. Continuing with squad update...', 'error');
                    } else {
                        console.log('Player details updated successfully');
                    }
                    
                    // 2. Then update or insert squad data
                    if (editingSquadId) {
                        // Update existing squad entry
                        const { error } = await supabase
                            .from('manager_squads')
                            .update(squadData)
                            .eq('id', editingSquadId);
                            
                        if (error) throw error;
                        
                        showToast('Squad player and player details updated successfully in both tables');
                    } else {
                        // Create new squad entry
                        const { error } = await supabase
                            .from('manager_squads')
                            .insert([squadData]);
                            
                        if (error) throw error;
                        
                        showToast('Player added to squad and player details updated successfully in both tables');
                    }
                    
                    // Close modal and refresh squad list
                    closeAddSquadModal();
                    await loadManagerSquad(currentManager.id);
                    
                    // Reload available players to reflect any changes
                    await loadAvailablePlayers();
                } catch (error) {
                    showToast('Error saving squad player: ' + error.message, 'error');
                }
            }
            
            // Delete squad player
            async function deleteSquadPlayer(squadId) {
                if (!confirm('Are you sure you want to remove this player from the squad?')) {
                    return;
                }
                
                try {
                    // First get the squad entry to know the player_id and details
                    const { data: squadData, error: getError } = await supabase
                        .from('manager_squads')
                        .select('player_id, player_type')
                        .eq('id', squadId)
                        .single();
                        
                    if (getError) throw getError;
                    
                    const playerId = squadData?.player_id;
                    const playerType = squadData?.player_type || 'standard';
                    
                    if (!playerId) {
                        showToast('Unable to find player information', 'error');
                        return;
                    }
                    
                    // Get player details to access star rating
                    const { data: playerData, error: playerError } = await supabase
                        .from('players')
                        .select('id, name, star_rating, club_history')
                        .eq('id', playerId)
                        .single();
                        
                    if (playerError) {
                        console.error('Error getting player details:', playerError);
                        showToast('Error retrieving player details', 'error');
                        return;
                    }
                    
                    // Ask for current season
                    const currentSeason = prompt(
                        `Enter the current season (e.g. 6, 6.5) to update ${playerData.name}'s history:`, 
                        currentManager?.current_season || ''
                    );
                    
                    if (currentSeason === null) {
                        // User canceled the operation
                        return;
                    }
                    
                    // Delete the squad entry
                    const { error } = await supabase
                        .from('manager_squads')
                        .delete()
                        .eq('id', squadId);
                        
                    if (error) throw error;
                    
                    // Check if player is in any other squads
                    const { data: otherSquads, error: checkError } = await supabase
                        .from('manager_squads')
                        .select('id')
                        .eq('player_id', playerId);
                        
                    if (checkError) {
                        console.error('Error checking player squads:', checkError);
                    }
                    
                    // If this was the player's only squad, set them as a free agent
                    // and update their value based on star_rating and player_type
                    if (!otherSquads || otherSquads.length === 0) {
                        console.log(`Player ${playerId} was removed from their only squad, updating club_id to null and adjusting value`);
                        
                        // Determine new value based on star rating and player type
                        let newValue;
                        const starRating = playerData.star_rating || 3;
                        
                        if (playerType === 'legend' || playerType === 'prime legend') {
                            if (starRating >= 5) {
                                newValue = 100;
                            } else if (starRating >= 4) {
                                newValue = 60;
                            } else {
                                newValue = 40; // Default for other star ratings
                            }
                        } else { // standard, prime, icon
                            if (starRating >= 5) {
                                newValue = 80;
                            } else if (starRating >= 4) {
                                newValue = 50;
                            } else { // 3 star or less
                                newValue = 40;
                            }
                        }
                        
                        // Update club history if available
                        let updatedClubHistory = playerData.club_history;
                        
                        if (updatedClubHistory) {
                            // Try to find the last entry and update the end season
                            try {
                                // Check if club_history is a string that needs parsing
                                if (typeof updatedClubHistory === 'string') {
                                    updatedClubHistory = JSON.parse(updatedClubHistory);
                                }
                                
                                // Make sure it's an array
                                if (Array.isArray(updatedClubHistory) && updatedClubHistory.length > 0) {
                                    // Get the last entry
                                    const lastEntry = updatedClubHistory[updatedClubHistory.length - 1];
                                    
                                    // Update the end season if this is the current club
                                    if (lastEntry && !lastEntry.end_season) {
                                        lastEntry.end_season = currentSeason;
                                        console.log(`Updated club history: set end_season to ${currentSeason}`);
                                    }
                                }
                            } catch (historyError) {
                                console.error('Error updating club history:', historyError);
                            }
                        }
                        
                        // Update player in the database
                        const { error: updateError } = await supabase
                            .from('players')
                            .update({ 
                                club_id: null,
                                value: newValue,
                                club_history: updatedClubHistory
                            })
                            .eq('id', playerId);
                            
                        if (updateError) {
                            console.error('Error updating player club_id and value:', updateError);
                        } else {
                            console.log(`Set player ${playerId} as free agent with adjusted value: ${newValue}`);
                            showToast(`Player removed from squad and value adjusted to ${newValue}`);
                        }
                    } else {
                        showToast('Player removed from this squad but remains in other squads');
                    }
                    
                    // Refresh squad list
                    await loadManagerSquad(currentManager.id);
                } catch (error) {
                    showToast('Error removing player from squad: ' + error.message, 'error');
                }
            }
            
            // Open add season modal
            function openAddSeasonModal() {
                if (!currentManager) {
                    showToast('Please save the manager first', 'error');
                    return;
                }
                
                // Reset form values
                seasonNumberInput.value = managerSeasons.length + 1;
                seasonRankInput.value = '';
                seasonRankPointsInput.value = '';
                seasonIncomeInput.value = '';
                seasonExpenseInput.value = '';
                seasonProfitInput.value = '';
                seasonRewardsInput.value = '';
                
                // Reset match stats
                seasonMatchesInput.value = '0';
                seasonWinsInput.value = '0';
                seasonDrawsInput.value = '0';
                seasonLossesInput.value = '0';
                seasonGoalsScoredInput.value = '0';
                seasonGoalsConcededInput.value = '0';
                seasonGoalDiffInput.value = '0';
                seasonCleanSheetsInput.value = '0';
                
                // Reset competitions
                clearCompetitionFields();
                
                // Reset editing state
                editingSeasonId = null;
                
                // Update modal title
                document.querySelector('#season-modal .modal-header h3').textContent = 'Add Season';
                
                // Show modal
                seasonModal.classList.add('active');
            }
            
            // Edit season
            function editSeason(seasonId) {
                const season = managerSeasons.find(s => s.id === seasonId);
                if (!season) return;
                
                // Set editing state
                editingSeasonId = seasonId;
                
                // Update modal title
                document.querySelector('#season-modal .modal-header h3').textContent = 'Edit Season';
                
                // Populate form with season data - Basic info
                seasonNumberInput.value = season.number || 1;
                seasonRankInput.value = season.manager_rank || '';
                seasonRankPointsInput.value = season.rank_point || '';
                seasonIncomeInput.value = season.team_income || '';
                seasonExpenseInput.value = season.team_expense || '';
                seasonProfitInput.value = season.team_profit || '';
                seasonRewardsInput.value = season.session_rewards || '';
                
                // Populate match statistics
                seasonMatchesInput.value = season.matches || '0';
                seasonWinsInput.value = season.wins || '0';
                seasonDrawsInput.value = season.draws || '0';
                seasonLossesInput.value = season.losses || '0';
                seasonGoalsScoredInput.value = season.goals_scored || '0';
                seasonGoalsConcededInput.value = season.goals_conceded || '0';
                seasonGoalDiffInput.value = season.goal_difference || '0';
                seasonCleanSheetsInput.value = season.clean_sheets || '0';
                
                // Populate competitions
                clearCompetitionFields(); // First clear existing competitions
                
                if (season.competitions && Array.isArray(season.competitions)) {
                    // If competitions array exists in the data
                    if (season.competitions.length > 0) {
                        // Set the first competition entry
                        document.querySelector('#competition-name-1').value = season.competitions[0].name || '';
                        document.querySelector('#competition-placement-1').value = season.competitions[0].placement || '';
                        document.querySelector('#competition-stage-1').value = season.competitions[0].stage || '';
                        
                        // Add additional competition entries if needed
                        for (let i = 1; i < season.competitions.length; i++) {
                            addCompetitionField();
                            document.querySelector(`#competition-name-${i+1}`).value = season.competitions[i].name || '';
                            document.querySelector(`#competition-placement-${i+1}`).value = season.competitions[i].placement || '';
                            document.querySelector(`#competition-stage-${i+1}`).value = season.competitions[i].stage || '';
                        }
                    }
                }
                
                // Show modal
                seasonModal.classList.add('active');
            }
            
            // Save season
            async function saveSeason() {
                if (!currentManager) {
                    showToast('No manager selected', 'error');
                    return;
                }
                
                if (!seasonNumberInput.value) {
                    showToast('Season number is required', 'error');
                    return;
                }
                
                try {
                    // Gather all season data
                    const seasonData = {
                        manager_id: currentManager.id,
                        number: parseInt(seasonNumberInput.value),
                        manager_rank: seasonRankInput.value || null,
                        rank_point: parseFloat(seasonRankPointsInput.value) || null,
                        team_income: parseInt(seasonIncomeInput.value) || null,
                        team_expense: parseInt(seasonExpenseInput.value) || null,
                        team_profit: parseInt(seasonProfitInput.value) || null,
                        session_rewards: parseInt(seasonRewardsInput.value) || null
                    };
                    
                    // Prepare season stats data separately
                    const seasonStatsData = {
                        matches: parseInt(seasonMatchesInput.value) || 0,
                        wins: parseInt(seasonWinsInput.value) || 0,
                        draws: parseInt(seasonDrawsInput.value) || 0,
                        losses: parseInt(seasonLossesInput.value) || 0,
                        goals_scored: parseInt(seasonGoalsScoredInput.value) || 0,
                        goals_conceded: parseInt(seasonGoalsConcededInput.value) || 0,
                        goal_difference: parseInt(seasonGoalDiffInput.value) || 0,
                        clean_sheets: parseInt(seasonCleanSheetsInput.value) || 0
                    };
                    
                    // Validate match stats
                    validateMatchStatistics();
                    
                    // Process competitions - First get all competitions from db
                    const { data: existingCompetitions, error: compError } = await supabase
                        .from('competitions')
                        .select('id, name');
                        
                    if (compError) throw compError;
                    
                    // Collect competitions data from form
                    const competitionEntries = competitionsContainer.querySelectorAll('.competition-entry');
                    const competitionsToProcess = [];
                    
                    for (const entry of competitionEntries) {
                        const nameInput = entry.querySelector('.competition-name');
                        const placementInput = entry.querySelector('.competition-placement');
                        const stageInput = entry.querySelector('.competition-stage');
                        
                        if (nameInput.value.trim() === '') continue;
                        
                        const competitionName = nameInput.value.trim();
                        const placement = placementInput.value.trim() || null;
                        const stage = stageInput.value.trim() || null;
                        
                        // Check if competition already exists
                        let competitionId = null;
                        const existingComp = existingCompetitions.find(c => 
                            c.name.toLowerCase() === competitionName.toLowerCase());
                        
                        if (existingComp) {
                            competitionId = existingComp.id;
                        } else {
                            // Create new competition
                            const { data: newComp, error: createCompError } = await supabase
                                .from('competitions')
                                .insert([{ name: competitionName }])
                                .select()
                                .single();
                                
                            if (createCompError) {
                                console.error('Error creating competition:', createCompError);
                                // Continue even with error
                                continue;
                            }
                            
                            competitionId = newComp.id;
                        }
                        
                        // Add to the list to process
                        if (competitionId) {
                            competitionsToProcess.push({
                                competition_id: competitionId,
                                placement: placement,
                                stage: stage
                            });
                        }
                    }
                    
                    let seasonId;
                    
                    if (editingSeasonId) {
                        // Update existing season
                        const { error } = await supabase
                            .from('seasons')
                            .update(seasonData)
                            .eq('id', editingSeasonId);
                            
                        if (error) throw error;
                        
                        seasonId = editingSeasonId;
                        
                        // Update season stats
                        const { data: existingStats, error: statsCheckError } = await supabase
                            .from('season_stats')
                            .select('id')
                            .eq('season_id', seasonId)
                            .maybeSingle();
                        
                        if (statsCheckError) throw statsCheckError;
                        
                        if (existingStats) {
                            // Update existing stats
                            const { error: statsUpdateError } = await supabase
                                .from('season_stats')
                                .update({
                                    ...seasonStatsData,
                                    season_id: seasonId
                                })
                                .eq('season_id', seasonId);
                                
                            if (statsUpdateError) throw statsUpdateError;
                        } else {
                            // Create new stats entry
                            const { error: statsInsertError } = await supabase
                                .from('season_stats')
                                .insert([{
                                    ...seasonStatsData,
                                    season_id: seasonId
                                }]);
                                
                            if (statsInsertError) throw statsInsertError;
                        }
                        
                        // Delete existing competition entries for this season
                        const { error: deleteCompError } = await supabase
                            .from('season_competitions')
                            .delete()
                            .eq('season_id', seasonId);
                            
                        if (deleteCompError) throw deleteCompError;
                        
                        showToast('Season updated successfully');
                    } else {
                        // Check if season already exists
                        const { data: existingSeason, error: checkError } = await supabase
                            .from('seasons')
                            .select('id')
                            .eq('manager_id', currentManager.id)
                            .eq('number', seasonData.number)
                            .maybeSingle();
                            
                        if (checkError) throw checkError;
                        
                        if (existingSeason) {
                            showToast(`Season ${seasonData.number} already exists`, 'error');
                            return;
                        }
                        
                        // Create new season
                        const { data: newSeason, error } = await supabase
                            .from('seasons')
                            .insert([seasonData])
                            .select()
                            .single();
                            
                        if (error) throw error;
                        
                        seasonId = newSeason.id;
                        
                        // Create new season stats entry
                        const { error: statsInsertError } = await supabase
                            .from('season_stats')
                            .insert([{
                                ...seasonStatsData,
                                season_id: seasonId
                            }]);
                            
                        if (statsInsertError) throw statsInsertError;
                        
                        showToast('Season added successfully');
                    }
                    
                    // Insert season_competitions entries
                    if (competitionsToProcess.length > 0) {
                        const seasonCompetitions = competitionsToProcess.map(comp => ({
                            ...comp,
                            season_id: seasonId
                        }));
                        
                        const { error: compInsertError } = await supabase
                            .from('season_competitions')
                            .insert(seasonCompetitions);
                            
                        if (compInsertError) {
                            console.error('Error inserting season competitions:', compInsertError);
                            showToast('Warning: Some competition entries may not have been saved', 'error');
                        }
                    }
                    
                    // Close modal and refresh seasons list
                    closeAddSeasonModal();
                    await loadManagerSeasons(currentManager.id);
                } catch (error) {
                    showToast('Error saving season: ' + error.message, 'error');
                    console.error('Error saving season:', error);
                }
            }
            
            // Delete season
            async function deleteSeason(seasonId) {
                if (!confirm('Are you sure you want to delete this season?')) {
                    return;
                }
                
                try {
                    // First, delete related records from season_competitions
                    const { error: compDeleteError } = await supabase
                        .from('season_competitions')
                        .delete()
                        .eq('season_id', seasonId);
                        
                    if (compDeleteError) throw compDeleteError;
                    
                    // Delete related records from season_stats
                    const { error: statsDeleteError } = await supabase
                        .from('season_stats')
                        .delete()
                        .eq('season_id', seasonId);
                        
                    if (statsDeleteError) throw statsDeleteError;
                    
                    // Finally, delete the season record
                    const { error } = await supabase
                        .from('seasons')
                        .delete()
                        .eq('id', seasonId);
                        
                    if (error) throw error;
                    
                    showToast('Season deleted successfully');
                    
                    // Refresh seasons list
                    await loadManagerSeasons(currentManager.id);
                } catch (error) {
                    showToast('Error deleting season: ' + error.message, 'error');
                    console.error('Error deleting season:', error);
                }
            }
            
            // Verify data synchronization between tables
            async function verifyDataSync() {
                try {
                    showToast('Starting synchronization verification...', 'success');
                    
                    // Get all manager_squads with player_id
                    const { data: squads, error: squadsError } = await supabase
                        .from('manager_squads')
                        .select('id, player_id, player_name, position, value, player_type')
                        .not('player_id', 'is', null);
                        
                    if (squadsError) throw squadsError;
                    
                    if (!squads || squads.length === 0) {
                        showToast('No squad players with player IDs found', 'error');
                        return;
                    }
                    
                    console.log(`Found ${squads.length} squad players to verify`);
                    
                    // Get all related player IDs
                    const playerIds = squads.map(squad => squad.player_id);
                    
                    // Get player details
                    const { data: players, error: playersError } = await supabase
                        .from('players')
                        .select('id, name, position, value')
                        .in('id', playerIds);
                        
                    if (playersError) throw playersError;
                    
                    // Check for mismatches
                    let mismatches = 0;
                    let fixedEntries = 0;
                    
                    for (const squad of squads) {
                        const player = players.find(p => p.id === squad.player_id);
                        
                        if (!player) {
                            console.warn(`Player ID ${squad.player_id} referenced in squad but not found in players table`);
                            continue;
                        }
                        
                        // Check for name, position, or value mismatches
                        const nameMatch = squad.player_name === player.name;
                        const positionMatch = squad.position === player.position;
                        const valueMatch = squad.value === player.value;
                        
                        if (!nameMatch || !positionMatch || !valueMatch) {
                            mismatches++;
                            console.log(`Mismatch found for player ${player.name} (ID: ${player.id}):`);
                            
                            if (!nameMatch) console.log(`  Name: Squad has "${squad.player_name}", Player has "${player.name}"`);
                            if (!positionMatch) console.log(`  Position: Squad has "${squad.position}", Player has "${player.position}"`);
                            if (!valueMatch) console.log(`  Value: Squad has ${squad.value}, Player has ${player.value}`);
                            
                            // Ask if we should fix this mismatch
                            if (confirm(`Mismatch found for player ${player.name} (ID: ${player.id}).\n\nDo you want to fix this issue?`)) {
                                try {
                                    // Update squad to match player data
                                    const { error: updateError } = await supabase
                                        .from('manager_squads')
                                        .update({
                                            player_name: player.name,
                                            position: player.position,
                                            value: player.value
                                        })
                                        .eq('id', squad.id);
                                        
                                    if (updateError) {
                                        console.error(`Error fixing squad entry ${squad.id}:`, updateError);
                                    } else {
                                        fixedEntries++;
                                        console.log(`Fixed mismatch for ${player.name}`);
                                    }
                                } catch (fixError) {
                                    console.error(`Exception fixing squad entry ${squad.id}:`, fixError);
                                }
                            }
                        }
                    }
                    
                    // Show results
                    if (mismatches === 0) {
                        showToast(`All ${squads.length} squad entries are properly synchronized!`, 'success');
                    } else {
                        showToast(`Found ${mismatches} mismatches, fixed ${fixedEntries}`, 'success');
                        
                        // Refresh squad list if fixes were applied
                        if (fixedEntries > 0 && currentManager) {
                            await loadManagerSquad(currentManager.id);
                        }
                    }
                } catch (error) {
                    showToast('Error verifying synchronization: ' + error.message, 'error');
                    console.error('Sync verification error:', error);
                }
            }
            
            // Populate player details when a player is selected
            function populatePlayerDetails() {
                const selectedPlayerId = playerSelect.value;
                if (!selectedPlayerId) return;
                
                const selectedPlayer = availablePlayers.find(p => p.id == selectedPlayerId);
                if (!selectedPlayer) return;
                
                // Auto-populate position from player data
                if (selectedPlayer.position) {
                    squadPositionSelect.value = selectedPlayer.position;
                }
                
                // If we have player value from the database, auto-populate it
                if (selectedPlayer.value) {
                    squadValueInput.value = selectedPlayer.value;
                    // Also calculate the salary
                    calculateSalary();
                }
                
                // Set default contract if not already set
                if (!squadContractInput.value) {
                    const currentSeason = currentManager?.current_season || 1;
                    squadContractInput.value = `SEASON ${currentSeason}`;
                }
            }
            
            // Calculate salary as 5% of value
            function calculateSalary() {
                const value = parseInt(squadValueInput.value) || 0;
                if (value > 0) {
                    // Calculate salary as 5% of value
                    const salary = value * 0.05;
                    squadSalaryInput.value = salary.toFixed(1);
                }
            }
            
            // Toggle mobile menu
            function toggleMobileMenu() {
                mobileMenuOpen = !mobileMenuOpen;
                userMenu.classList.toggle('show', mobileMenuOpen);
                sidebar.classList.toggle('show', mobileMenuOpen);
                
                // Change icon based on state
                const icon = mobileMenuToggle.querySelector('i');
                if (mobileMenuOpen) {
                    icon.classList.remove('fa-bars');
                    icon.classList.add('fa-times');
                } else {
                    icon.classList.remove('fa-times');
                    icon.classList.add('fa-bars');
                }
            }
            
            // Handle window resize
            function handleWindowResize() {
                if (window.innerWidth > 768) {
                    // Reset mobile menu state on desktop
                    userMenu.classList.remove('show');
                    sidebar.classList.remove('show');
                    mobileMenuOpen = false;
                    
                    const icon = mobileMenuToggle.querySelector('i');
                    icon.classList.remove('fa-times');
                    icon.classList.add('fa-bars');
                }
            }

            // Close add season modal
            function closeAddSeasonModal() {
                seasonModal.classList.remove('active');
            }

            // Render squad list
            function renderSquadList() {
                if (!managerSquad || managerSquad.length === 0) {
                    squadList.innerHTML = '<div class="empty-message">No players in squad</div>';
                    return;
                }
                
                squadList.innerHTML = '';
                
                managerSquad.forEach(player => {
                    const playerName = player.players?.name || player.player_name || 'Unknown Player';
                    const position = player.position || player.players?.position || 'N/A';
                    const value = player.value ? player.value.toLocaleString() : 'N/A';
                    const playerType = player.player_type || 'standard';
                    
                    const listItem = document.createElement('div');
                    listItem.className = 'squad-item';
                    
                    listItem.innerHTML = `
                        <div class="squad-info">
                            <div class="squad-player-name">${playerName}</div>
                            <div class="squad-details">
                                <div class="squad-player-position">${position}</div>
                                <div class="squad-player-type"><i class="fas fa-user-tag"></i> ${playerType}</div>
                            </div>
                        </div>
                        <div class="squad-details">
                            <div class="squad-player-value"><i class="fas fa-coins"></i> ${value}</div>
                            <div class="squad-player-contract"><i class="fas fa-file-contract"></i> ${player.contract || 'N/A'}</div>
                        </div>
                        <div class="squad-player-actions">
                            <button class="edit-btn" title="Edit player" data-id="${player.id}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="delete-btn" title="Remove from squad" data-id="${player.id}">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                    `;
                    
                    // Add event listeners
                    const editBtn = listItem.querySelector('.edit-btn');
                    const deleteBtn = listItem.querySelector('.delete-btn');
                    
                    editBtn.addEventListener('click', () => editSquadPlayer(player.id));
                    deleteBtn.addEventListener('click', () => deleteSquadPlayer(player.id));
                    
                    squadList.appendChild(listItem);
                });
            }

            // Verify season competitions synchronization
            async function verifySeasonCompetitionsSync() {
                try {
                    showToast('Starting season competitions verification...', 'success');
                    
                    // Get all season_competitions entries
                    const { data: seasonComps, error: scError } = await supabase
                        .from('season_competitions')
                        .select('id, season_id, competition_id, placement, stage')
                        .not('competition_id', 'is', null);
                        
                    if (scError) throw scError;
                    
                    if (!seasonComps || seasonComps.length === 0) {
                        showToast('No season competitions found to verify', 'error');
                        return;
                    }
                    
                    console.log(`Found ${seasonComps.length} season competition entries to verify`);
                    
                    // Get all competition IDs
                    const competitionIds = [...new Set(seasonComps.map(sc => sc.competition_id))];
                    
                    // Get competition details
                    const { data: competitions, error: compError } = await supabase
                        .from('competitions')
                        .select('id, name')
                        .in('id', competitionIds);
                        
                    if (compError) throw compError;
                    
                    // Check for orphaned entries (competition_id that doesn't exist)
                    let orphaned = 0;
                    let processed = 0;
                    
                    for (const sc of seasonComps) {
                        const competitionExists = competitions.some(c => c.id === sc.competition_id);
                        
                        if (!competitionExists) {
                            orphaned++;
                            console.warn(`Found orphaned season_competition entry (ID: ${sc.id}) referencing non-existent competition ID ${sc.competition_id}`);
                            
                            if (confirm(`Found orphaned season_competition entry (ID: ${sc.id}). Delete this entry?`)) {
                                const { error: deleteError } = await supabase
                                    .from('season_competitions')
                                    .delete()
                                    .eq('id', sc.id);
                                    
                                if (deleteError) {
                                    console.error(`Error deleting orphaned entry:`, deleteError);
                                } else {
                                    processed++;
                                    console.log(`Deleted orphaned entry ID ${sc.id}`);
                                }
                            }
                        }
                    }
                    
                    // Show results
                    if (orphaned === 0) {
                        showToast(`All ${seasonComps.length} season competition entries are valid!`, 'success');
                    } else {
                        showToast(`Found ${orphaned} orphaned entries, processed ${processed}`, processed > 0 ? 'success' : 'error');
                        
                        // Refresh seasons list if fixes were applied
                        if (processed > 0 && currentManager) {
                            await loadManagerSeasons(currentManager.id);
                        }
                    }
                } catch (error) {
                    showToast('Error verifying season competitions: ' + error.message, 'error');
                    console.error('Season competitions verification error:', error);
                }
            }
        });
    </script>
</body>
</html> 