<!DOCTYPE html>
<html lang="en">
<head>
    <!-- PWA support -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#3498db">
    <link rel="apple-touch-icon" href="/assets/images/icon-192x192.png">

    <!-- DNS prefetch and preconnect -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&display=swap" media="print" onload="this.media='all'" crossorigin>
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&display=swap"></noscript>
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
    <link rel="icon" href="assets/images/logo11.webp" type="image/webp">
    <link rel="shortcut icon" href="assets/images/logo11.webp" type="image/webp">
    <link rel="apple-touch-icon" href="assets/images/logo11.webp">
    <link rel="dns-prefetch" href="https://assets.mixkit.co">
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <title>GitHub Configuration</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #1a1a1a;
            color: #e3e3e3;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .container {
            background-color: #282828;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            width: 100%;
            max-width: 600px;
        }
        h1, h2 {
            text-align: center;
            color: #fff;
        }
        .info-panel {
            background-color: #333;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        .warning {
            background-color: rgba(255, 87, 34, 0.2);
            border-left: 4px solid #ff5722;
            padding: 10px 15px;
            margin-bottom: 20px;
        }
        .success {
            background-color: rgba(76, 175, 80, 0.2);
            border-left: 4px solid #4caf50;
            padding: 10px 15px;
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }
        input {
            width: 100%;
            padding: 12px;
            border-radius: 4px;
            border: 1px solid #444;
            background-color: #333;
            color: #fff;
            box-sizing: border-box;
            font-size: 16px;
        }
        input:focus {
            outline: none;
            border-color: #4caf50;
            box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.2);
        }
        button {
            width: 100%;
            padding: 12px;
            background-color: #4caf50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin-top: 10px;
        }
        button:hover {
            background-color: #45a049;
        }
        .secondary-button {
            background-color: #3f51b5;
        }
        .secondary-button:hover {
            background-color: #303f9f;
        }
        ol {
            margin-left: 20px;
            padding-left: 0;
        }
        li {
            margin-bottom: 10px;
        }
        .status-message {
            padding: 10px;
            margin-top: 15px;
            border-radius: 4px;
            display: none;
        }
        .status-success {
            background-color: rgba(76, 175, 80, 0.2);
            color: #4caf50;
            border: 1px solid #4caf50;
        }
        .status-error {
            background-color: rgba(244, 67, 54, 0.2);
            color: #f44336;
            border: 1px solid #f44336;
        }
        .button-container {
            display: flex;
            gap: 10px;
        }
        .hidden {
            display: none;
        }
        .section-tabs {
            display: flex;
            margin-bottom: 20px;
        }
        .tab {
            flex: 1;
            padding: 10px;
            text-align: center;
            background-color: #333;
            cursor: pointer;
            border-radius: 4px 4px 0 0;
        }
        .tab.active {
            background-color: #3f51b5;
            font-weight: bold;
        }
        .section {
            display: none;
        }
        .section.active {
            display: block;
        }
    </style>

    <!-- Performance optimized CSS -->
    <link rel="stylesheet" href="css/performance.css" media="print" onload="this.media='all'">
    <noscript><link rel="stylesheet" href="css/performance.css">
    <link rel="stylesheet" href="css/additional-fixes.css"></noscript>

</head>
<body>
    <div class="container">
        <h1>GitHub Configuration</h1>
        
        <div class="warning">
            <p><strong>Important:</strong> Never share your GitHub token publicly. If you accidentally exposed your token, revoke it immediately on GitHub and create a new one.</p>
        </div>
        
        <div class="section-tabs">
            <div class="tab active" data-tab="setup">Setup</div>
            <div class="tab" data-tab="test">Test Connection</div>
            <div class="tab" data-tab="advanced">Advanced</div>
        </div>
        
        <div class="section active" data-tab="setup">
            <div class="info-panel">
                <h3>How to Get a GitHub Token</h3>
                <ol>
                    <li>Go to GitHub → Settings → Developer settings → Personal access tokens → Fine-grained tokens</li>
                    <li>Click "Generate new token"</li>
                    <li>Give it a name like "R2G Player Admin"</li>
                    <li>Set expiration according to your needs</li>
                    <li>Select your repository as the only one this token can access</li>
                    <li>Under "Repository permissions", set "Contents" to "Read and write"</li>
                    <li>Click "Generate token" and copy the token value</li>
                </ol>
            </div>
            
            <div class="form-group">
                <label for="github-token">GitHub Personal Access Token</label>
                <input type="password" id="github-token" placeholder="Paste your GitHub token here">
            </div>
            
            <div class="form-group">
                <label for="github-username">GitHub Username</label>
                <input type="text" id="github-username" placeholder="Your GitHub username">
            </div>
            
            <div class="form-group">
                <label for="github-repo">Repository Name</label>
                <input type="text" id="github-repo" placeholder="Your repository name">
            </div>
            
            <div class="form-group">
                <label for="github-branch">Branch Name</label>
                <input type="text" id="github-branch" placeholder="main" value="main">
            </div>
            
            <button id="save-config-btn">Save Configuration</button>
        </div>
        
        <div class="section" data-tab="test">
            <div class="info-panel">
                <p>Test your GitHub configuration to make sure it can access your repository and the players.json file.</p>
            </div>
            
            <div id="connection-status" class="status-message"></div>
            
            <div class="button-container">
                <button id="test-connection-btn">Test Connection</button>
                <button id="goto-admin-btn" class="secondary-button">Go to Admin Panel</button>
            </div>
        </div>
        
        <div class="section" data-tab="advanced">
            <div class="info-panel">
                <p>Advanced settings for managing your GitHub configuration.</p>
            </div>
            
            <div class="form-group">
                <label for="json-path">JSON File Path</label>
                <input type="text" id="json-path" placeholder="players.json" value="players.json">
                <p><small>Path to the players.json file in your repository</small></p>
            </div>
            
            <div class="form-group">
                <label for="commit-message">Default Commit Message</label>
                <input type="text" id="commit-message" placeholder="Update player data" value="Update player data">
            </div>
            
            <div class="form-group">
                <div class="button-container">
                    <button id="save-advanced-btn">Save Advanced Settings</button>
                    <button id="clear-config-btn" class="secondary-button">Clear All Settings</button>
                </div>
            </div>
        </div>
        
        <div id="status-message" class="status-message"></div>
    </div>
    
    <script defer src="github-config.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Load saved values
            document.getElementById('github-token').value = localStorage.getItem('githubToken') || '';
            document.getElementById('github-username').value = localStorage.getItem('githubOwner') || githubConfig.defaultOwner;
            document.getElementById('github-repo').value = localStorage.getItem('githubRepo') || githubConfig.defaultRepo;
            document.getElementById('github-branch').value = localStorage.getItem('githubBranch') || githubConfig.defaultBranch;
            document.getElementById('json-path').value = localStorage.getItem('githubJsonPath') || githubConfig.filePath;
            document.getElementById('commit-message').value = localStorage.getItem('githubCommitMessage') || 'Update player data';
            
            // Tab functionality
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.dataset.tab;
                    
                    // Update active tab
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show active section
                    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
                    document.querySelector(`.section[data-tab="${tabName}"]`).classList.add('active');
                });
            });
            
            // Save configuration
            document.getElementById('save-config-btn').addEventListener('click', function() {
                const token = document.getElementById('github-token').value.trim();
                const username = document.getElementById('github-username').value.trim();
                const repo = document.getElementById('github-repo').value.trim();
                const branch = document.getElementById('github-branch').value.trim();
                
                if (!token || !username || !repo || !branch) {
                    showMessage('Please fill in all required fields', false);
                    return;
                }
                
                // Save to localStorage
                localStorage.setItem('githubToken', token);
                localStorage.setItem('githubOwner', username);
                localStorage.setItem('githubRepo', repo);
                localStorage.setItem('githubBranch', branch);
                
                showMessage('Configuration saved successfully!', true);
                
                // Switch to test tab
                document.querySelector('.tab[data-tab="test"]').click();
            });
            
            // Save advanced settings
            document.getElementById('save-advanced-btn').addEventListener('click', function() {
                const jsonPath = document.getElementById('json-path').value.trim();
                const commitMessage = document.getElementById('commit-message').value.trim();
                
                if (!jsonPath) {
                    showMessage('JSON file path cannot be empty', false);
                    return;
                }
                
                // Save to localStorage
                localStorage.setItem('githubJsonPath', jsonPath);
                localStorage.setItem('githubCommitMessage', commitMessage);
                
                showMessage('Advanced settings saved successfully!', true);
            });
            
            // Clear all settings
            document.getElementById('clear-config-btn').addEventListener('click', function() {
                if (confirm('Are you sure you want to clear all GitHub configuration settings?')) {
                    localStorage.removeItem('githubToken');
                    localStorage.removeItem('githubOwner');
                    localStorage.removeItem('githubRepo');
                    localStorage.removeItem('githubBranch');
                    localStorage.removeItem('githubJsonPath');
                    localStorage.removeItem('githubCommitMessage');
                    
                    // Reset form fields
                    document.getElementById('github-token').value = '';
                    document.getElementById('github-username').value = githubConfig.defaultOwner;
                    document.getElementById('github-repo').value = githubConfig.defaultRepo;
                    document.getElementById('github-branch').value = githubConfig.defaultBranch;
                    document.getElementById('json-path').value = githubConfig.filePath;
                    document.getElementById('commit-message').value = 'Update player data';
                    
                    showMessage('All configuration settings have been cleared', true);
                }
            });
            
            // Test connection
            document.getElementById('test-connection-btn').addEventListener('click', async function() {
                const connectionStatus = document.getElementById('connection-status');
                connectionStatus.style.display = 'block';
                connectionStatus.textContent = 'Testing connection...';
                connectionStatus.className = 'status-message';
                
                try {
                    if (!githubConfig.isConfigured()) {
                        throw new Error('GitHub configuration is not complete. Please fill in all required fields in the Setup tab.');
                    }
                    
                    // Make a request to the GitHub API to check if the token is valid
                    const response = await fetch(`https://api.github.com/repos/${githubConfig.getOwner()}/${githubConfig.getRepo()}/contents/${localStorage.getItem('githubJsonPath') || githubConfig.filePath}?ref=${githubConfig.getBranch()}`, {
                        headers: {
                            'Authorization': `token ${githubConfig.getToken()}`
                        }
                    });
                    
                    if (response.status === 401) {
                        throw new Error('Authentication failed. Please check your GitHub token.');
                    }
                    
                    if (response.status === 404) {
                        throw new Error('Repository or file not found. Please check your repository details and file path.');
                    }
                    
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(`GitHub API error: ${errorData.message}`);
                    }
                    
                    // If we got here, the connection is successful
                    connectionStatus.textContent = 'Connection successful! You can now use the admin panel.';
                    connectionStatus.classList.add('status-success');
                    
                    // Show the "Go to Admin Panel" button
                    document.getElementById('goto-admin-btn').style.display = 'block';
                    
                } catch (error) {
                    connectionStatus.textContent = error.message;
                    connectionStatus.classList.add('status-error');
                    
                    // Hide the "Go to Admin Panel" button
                    document.getElementById('goto-admin-btn').style.display = 'none';
                }
            });
            
            // Go to admin panel
            document.getElementById('goto-admin-btn').addEventListener('click', function() {
                window.location.href = 'player-admin.html';
            });
            
            // Show message
            function showMessage(message, isSuccess) {
                const statusElement = document.getElementById('status-message');
                statusElement.textContent = message;
                statusElement.className = 'status-message';
                statusElement.classList.add(isSuccess ? 'status-success' : 'status-error');
                statusElement.style.display = 'block';
                
                // Hide the message after 5 seconds
                setTimeout(() => {
                    statusElement.style.display = 'none';
                }, 5000);
            }
        });
    </script>

    <!-- Performance optimization JS -->
    <script>
        // Immediately executed critical JS
        document.addEventListener('DOMContentLoaded', function() {
            // Load the video after page content
            setTimeout(function() {
                const video = document.querySelector('.video-bg');
                if (video && video.dataset.src) {
                    const source = document.createElement('source');
                    source.src = video.dataset.src;
                    source.type = 'video/mp4';
                    video.appendChild(source);
                    video.load();
                    video.play().catch(e => console.log('Autoplay prevented:', e));
                }
            }, 1000);
            
            // Set fade out for preloader
            window.addEventListener('load', function() {
                const preloader = document.querySelector('.preloader');
                if (preloader) {
                    setTimeout(function() {
                        preloader.style.opacity = '0';
                        setTimeout(function() {
                            preloader.style.display = 'none';
                        }, 500);
                    }, 500);
                }
            });
        });
    </script>
    <script src="js/remove-conflicting-styles.js"></script>
    
    <script src="js/background-fix.js"></script>
    
    <script src="js/background-mobile-scroll.js"></script>
    
    
    <script src="js/script.js"></script>
    <script src="js/fix-scroll.js"></script>    
</body>
</html> 
    